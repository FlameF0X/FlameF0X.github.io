<!DOCTYPE html><html lang="en" class="h-full"><head><style data-merge-styles="true"></style>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>i3-lab | Groq Compound</title>
    <link rel="icon" type="image/x-icon" href="/assets/logo.png">
    
    <!-- Tailwind & Fonts -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;900&amp;family=JetBrains+Mono:wght@300;500;700&amp;display=swap" rel="stylesheet">
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Marked.js (Markdown Parser) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/9.1.6/marked.min.js"></script>

    <!-- Highlight.js (Code Syntax Highlighting) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/base16/ashes.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    },
                    colors: {
                        bg: '#0c0a09',
                        surface: '#1c1917',
                        surface_hover: '#292524',
                        text: '#e7e5e4',
                        accent: '#ea580c',
                        'accent-dim': '#431407',
                        border: '#44403c',
                        lime: '#84cc16' 
                    },
                    animation: {
                        'spin-slow': 'spin 3s linear infinite',
                        'bounce-slow': 'bounce 3s infinite',
                    }
                }
            }
        }
    </script>

    <style type="text/tailwindcss">
        :root {
            --grid-color: rgba(231, 229, 228, 0.05);
        }
        
        body {
            background-color: theme('colors.bg');
            background-image: 
                linear-gradient(var(--grid-color) 1px, transparent 1px),
                linear-gradient(90deg, var(--grid-color) 1px, transparent 1px);
            background-size: 40px 40px;
            color: theme('colors.text');
        }

        .raw-border { border: 2px solid theme('colors.border'); }
        .raw-border-focus:focus-within { border-color: theme('colors.accent'); }
        
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: theme('colors.bg'); }
        ::-webkit-scrollbar-thumb { background: theme('colors.stone.800'); }
        ::-webkit-scrollbar-thumb:hover { background: theme('colors.accent'); }

        input[type=range] {
            -webkit-appearance: none;
            width: 100%;
            background: transparent;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 16px;
            width: 16px;
            background: theme('colors.accent');
            margin-top: -6px;
            cursor: pointer;
            border: 2px solid theme('colors.bg');
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            cursor: pointer;
            background: theme('colors.stone.800');
        }
        input[type=range]:focus::-webkit-slider-runnable-track {
            background: theme('colors.stone.700');
        }

        .hover-invert { transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1); }
        .hover-invert:hover {
            background-color: theme('colors.text');
            color: theme('colors.bg');
            border-color: theme('colors.text');
        }
        .hover-invert:hover * { color: theme('colors.bg'); stroke: theme('colors.bg'); }

        .bracket-box { position: relative; }
        .bracket-box::before, .bracket-box::after {
            content: '';
            position: absolute;
            width: 6px;
            height: 6px;
            border-color: theme('colors.accent');
            border-style: solid;
            transition: all 0.2s ease;
            opacity: 0;
        }
        .bracket-box::before { top: -1px; left: -1px; border-width: 2px 0 0 2px; }
        .bracket-box::after { bottom: -1px; right: -1px; border-width: 0 2px 2px 0; }
        
        @keyframes pulse-slow {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .animate-pulse-slow { animation: pulse-slow 3s cubic-bezier(0.4, 0, 0.6, 1) infinite; }

        .model-tab {
            @apply px-3 py-1 text-[10px] font-mono font-bold uppercase tracking-widest cursor-pointer border-t border-l border-r border-transparent text-stone-600 transition-all;
        }
        .model-tab.active {
            @apply bg-surface text-accent border-stone-800 border-b-bg translate-y-[1px] z-10;
        }
        .model-tab:hover:not(.active) {
            @apply text-stone-400 bg-stone-900;
        }

        .wrapped-gradient-text {
            background: linear-gradient(90deg, #ea580c 0%, #84cc16 50%, #ea580c 100%);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            background-size: 200% auto;
            animation: wrapped-shine 3s linear infinite;
        }
        @keyframes wrapped-shine {
            to { background-position: 200% center; }
        }
        .card-enter {
            animation: card-slide-up 0.8s cubic-bezier(0.16, 1, 0.3, 1) forwards;
            opacity: 0;
            transform: translateY(20px);
        }
        @keyframes card-slide-up {
            to { opacity: 1; transform: translateY(0); }
        }

        /* =============================================
           MARKDOWN RENDERING STYLES
           Scoped to .md-body for system (AI) messages
           ============================================= */

        .md-body {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.875rem;
            line-height: 1.75;
            color: #d6d3d1; /* stone-300 */
        }

        /* Headings */
        .md-body h1,
        .md-body h2,
        .md-body h3,
        .md-body h4,
        .md-body h5,
        .md-body h6 {
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: #ea580c; /* accent */
            margin-top: 1.4em;
            margin-bottom: 0.5em;
            line-height: 1.2;
        }
        .md-body h1 { font-size: 1.3rem; border-bottom: 1px solid #44403c; padding-bottom: 0.3em; }
        .md-body h2 { font-size: 1.1rem; }
        .md-body h3 { font-size: 0.95rem; color: #fb923c; }
        .md-body h4, .md-body h5, .md-body h6 { font-size: 0.85rem; color: #fdba74; }

        /* Paragraphs */
        .md-body p {
            margin-bottom: 0.85em;
            color: #d6d3d1;
        }
        .md-body p:last-child { margin-bottom: 0; }

        /* Links */
        .md-body a {
            color: #fb923c;
            text-decoration: underline;
            text-underline-offset: 3px;
            transition: color 0.15s;
        }
        .md-body a:hover { color: #ea580c; }

        /* Lists */
        .md-body ul,
        .md-body ol {
            margin: 0.6em 0 0.85em 0;
            padding-left: 1.5em;
        }
        .md-body ul { list-style-type: none; }
        .md-body ul li { position: relative; padding-left: 1.2em; margin-bottom: 0.3em; }
        .md-body ul li::before {
            content: '▸';
            position: absolute;
            left: 0;
            color: #ea580c;
            font-size: 0.75em;
            top: 0.2em;
        }
        .md-body ol { list-style-type: decimal; }
        .md-body ol li { padding-left: 0.3em; margin-bottom: 0.3em; }
        .md-body ol li::marker { color: #ea580c; font-weight: bold; }

        /* Nested lists */
        .md-body ul ul, .md-body ol ol,
        .md-body ul ol, .md-body ol ul {
            margin: 0.2em 0;
        }
        .md-body ul ul li::before { color: #84cc16; content: '◦'; }

        /* Inline code */
        .md-body code:not(pre code) {
            background: #1c1917;
            border: 1px solid #44403c;
            color: #84cc16;
            padding: 0.1em 0.45em;
            border-radius: 0;
            font-size: 0.82em;
            font-family: 'JetBrains Mono', monospace;
        }

        /* Code blocks */
        .md-body pre {
            background: #0c0a09 !important;
            border: 1px solid #44403c;
            border-left: 3px solid #ea580c;
            padding: 1em 1.2em;
            overflow-x: auto;
            margin: 0.85em 0;
            position: relative;
        }
        .md-body pre code {
            background: transparent !important;
            border: none !important;
            padding: 0 !important;
            font-size: 0.82em;
            color: #a8a29e;
            font-family: 'JetBrains Mono', monospace;
        }

        /* Code block language label */
        .md-body pre .code-lang-label {
            position: absolute;
            top: 0;
            right: 0;
            font-size: 0.65rem;
            font-family: 'JetBrains Mono', monospace;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            background: #ea580c;
            color: #0c0a09;
            padding: 1px 8px;
            font-weight: 700;
        }

        /* Copy button for code blocks */
        .md-body pre .copy-btn {
            position: absolute;
            top: 0;
            right: 0;
            font-size: 0.6rem;
            font-family: 'JetBrains Mono', monospace;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            background: #1c1917;
            color: #78716c;
            border: 1px solid #44403c;
            border-top: none;
            border-right: none;
            padding: 3px 10px;
            cursor: pointer;
            transition: all 0.15s;
        }
        .md-body pre .copy-btn:hover {
            background: #ea580c;
            color: #0c0a09;
            border-color: #ea580c;
        }

        /* Blockquote */
        .md-body blockquote {
            border-left: 3px solid #ea580c;
            padding: 0.5em 1em;
            margin: 0.85em 0;
            background: rgba(234, 88, 12, 0.05);
            color: #a8a29e;
            font-style: italic;
        }
        .md-body blockquote p { color: #a8a29e; margin-bottom: 0; }

        /* Horizontal rule */
        .md-body hr {
            border: none;
            border-top: 1px solid #44403c;
            margin: 1.2em 0;
        }

        /* Tables */
        .md-body table {
            width: 100%;
            border-collapse: collapse;
            margin: 0.85em 0;
            font-size: 0.8em;
            overflow-x: auto;
            display: block;
        }
        .md-body thead { background: #1c1917; }
        .md-body th {
            color: #ea580c;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.06em;
            font-size: 0.75em;
            padding: 0.5em 0.8em;
            border: 1px solid #44403c;
            text-align: left;
        }
        .md-body td {
            padding: 0.4em 0.8em;
            border: 1px solid #292524;
            color: #d6d3d1;
            vertical-align: top;
        }
        .md-body tr:nth-child(even) td { background: rgba(28,25,23,0.5); }
        .md-body tr:hover td { background: rgba(234,88,12,0.04); }

        /* Strong / Em */
        .md-body strong { color: #f5f5f4; font-weight: 700; }
        .md-body em { color: #a8a29e; font-style: italic; }

        /* Highlight.js overrides for the theme */
        .hljs { background: transparent !important; }
    </style>
<style>*, ::before, ::after{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgb(59 130 246 / 0.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }::backdrop{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgb(59 130 246 / 0.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }

/* ! tailwindcss v3.4.17 | MIT License | https://tailwindcss.com */*,::after,::before{box-sizing:border-box;border-width:0;border-style:solid;border-color:#e5e7eb}::after,::before{--tw-content:''}:host,html{line-height:1.5;-webkit-text-size-adjust:100%;-moz-tab-size:4;tab-size:4;font-family:Inter, sans-serif;font-feature-settings:normal;font-variation-settings:normal;-webkit-tap-highlight-color:transparent}body{margin:0;line-height:inherit}hr{height:0;color:inherit;border-top-width:1px}abbr:where([title]){-webkit-text-decoration:underline dotted;text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}b,strong{font-weight:bolder}code,kbd,pre,samp{font-family:JetBrains Mono, monospace;font-feature-settings:normal;font-variation-settings:normal;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{text-indent:0;border-color:inherit;border-collapse:collapse}button,input,optgroup,select,textarea{font-family:inherit;font-feature-settings:inherit;font-variation-settings:inherit;font-size:100%;font-weight:inherit;line-height:inherit;letter-spacing:inherit;color:inherit;margin:0;padding:0}button,select{text-transform:none}button,input:where([type=button]),input:where([type=reset]),input:where([type=submit]){-webkit-appearance:button;background-color:transparent;background-image:none}:-moz-focusring{outline:auto}:-moz-ui-invalid{box-shadow:none}progress{vertical-align:baseline}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,p,pre{margin:0}fieldset{margin:0;padding:0}legend{padding:0}menu,ol,ul{list-style:none;margin:0;padding:0}dialog{padding:0}textarea{resize:vertical}input::placeholder,textarea::placeholder{opacity:1;color:#9ca3af}[role=button],button{cursor:pointer}:disabled{cursor:default}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}[hidden]:where(:not([hidden=until-found])){display:none}.pointer-events-none{pointer-events:none}.fixed{position:fixed}.absolute{position:absolute}.relative{position:relative}.inset-0{inset:0px}.bottom-0{bottom:0px}.bottom-4{bottom:1rem}.left-0{left:0px}.left-4{left:1rem}.right-4{right:1rem}.top-4{top:1rem}.top-\[1px\]{top:1px}.-z-10{z-index:-10}.z-10{z-index:10}.z-20{z-index:20}.z-50{z-index:50}.z-\[100\]{z-index:100}.z-\[200\]{z-index:200}.mx-auto{margin-left:auto;margin-right:auto}.-ml-2{margin-left:-0.5rem}.mb-12{margin-bottom:3rem}.mb-2{margin-bottom:0.5rem}.mb-3{margin-bottom:0.75rem}.mb-6{margin-bottom:1.5rem}.ml-4{margin-left:1rem}.mt-2{margin-top:0.5rem}.mt-4{margin-top:1rem}.mt-8{margin-top:2rem}.mt-\[10vh\]{margin-top:10vh}.mt-auto{margin-top:auto}.mr-1{margin-right:0.25rem}.ml-1{margin-left:0.25rem}.block{display:block}.inline-block{display:inline-block}.flex{display:flex}.grid{display:grid}.hidden{display:none}.h-full{height:100%}.h-screen{height:100vh}.h-1\.5{height:0.375rem}.h-10{height:2.5rem}.h-12{height:3rem}.h-3{height:0.75rem}.h-32{height:8rem}.h-4{height:1rem}.h-5{height:1.25rem}.h-6{height:1.5rem}.h-8{height:2rem}.max-h-\[90vh\]{max-height:90vh}.min-h-\[1\.5em\]{min-height:1.5em}.w-1\.5{width:0.375rem}.w-10{width:2.5rem}.w-3{width:0.75rem}.w-4{width:1rem}.w-5{width:1.25rem}.w-6{width:1.5rem}.w-8{width:2rem}.w-\[280px\]{width:280px}.w-full{width:100%}.w-2{width:0.5rem}.w-\[70px\]{width:70px}.max-w-2xl{max-width:42rem}.max-w-3xl{max-width:48rem}.max-w-4xl{max-width:56rem}.max-w-lg{max-width:32rem}.max-w-md{max-width:28rem}.max-w-\[85\%\]{max-width:85%}.flex-1{flex:1 1 0%}.shrink-0{flex-shrink:0}@keyframes ping{75%, 100%{transform:scale(2);opacity:0}}.animate-ping{animation:ping 1s cubic-bezier(0, 0, 0.2, 1) infinite}@keyframes pulse{50%{opacity:.5}}.animate-pulse{animation:pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite}.cursor-pointer{cursor:pointer}.select-none{-webkit-user-select:none;user-select:none}.resize-none{resize:none}.grid-cols-1{grid-template-columns:repeat(1, minmax(0, 1fr))}.grid-cols-2{grid-template-columns:repeat(2, minmax(0, 1fr))}.flex-row{flex-direction:row}.flex-row-reverse{flex-direction:row-reverse}.flex-col{flex-direction:column}.items-start{align-items:flex-start}.items-center{align-items:center}.justify-start{justify-content:flex-start}.justify-end{justify-content:flex-end}.justify-center{justify-content:center}.justify-between{justify-content:space-between}.gap-1{gap:0.25rem}.gap-2{gap:0.5rem}.gap-3{gap:0.75rem}.gap-4{gap:1rem}.gap-6{gap:1.5rem}.gap-8{gap:2rem}.space-y-1 > :not([hidden]) ~ :not([hidden]){--tw-space-y-reverse:0;margin-top:calc(0.25rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(0.25rem * var(--tw-space-y-reverse))}.space-y-2 > :not([hidden]) ~ :not([hidden]){--tw-space-y-reverse:0;margin-top:calc(0.5rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(0.5rem * var(--tw-space-y-reverse))}.space-y-3 > :not([hidden]) ~ :not([hidden]){--tw-space-y-reverse:0;margin-top:calc(0.75rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(0.75rem * var(--tw-space-y-reverse))}.space-y-8 > :not([hidden]) ~ :not([hidden]){--tw-space-y-reverse:0;margin-top:calc(2rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(2rem * var(--tw-space-y-reverse))}.overflow-hidden{overflow:hidden}.overflow-y-auto{overflow-y:auto}.overflow-x-hidden{overflow-x:hidden}.truncate{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.whitespace-nowrap{white-space:nowrap}.break-words{overflow-wrap:break-word}.rounded-full{border-radius:9999px}.rounded-none{border-radius:0px}.border{border-width:1px}.border-2{border-width:2px}.border-b{border-bottom-width:1px}.border-l{border-left-width:1px}.border-l-2{border-left-width:2px}.border-r{border-right-width:1px}.border-t{border-top-width:1px}.border-none{border-style:none}.border-accent\/30{border-color:rgb(234 88 12 / 0.3)}.border-red-900\/30{border-color:rgb(127 29 29 / 0.3)}.border-stone-700{--tw-border-opacity:1;border-color:rgb(68 64 60 / var(--tw-border-opacity, 1))}.border-stone-800{--tw-border-opacity:1;border-color:rgb(41 37 36 / var(--tw-border-opacity, 1))}.border-transparent{border-color:transparent}.border-accent\/50{border-color:rgb(234 88 12 / 0.5)}.border-red-500{--tw-border-opacity:1;border-color:rgb(239 68 68 / var(--tw-border-opacity, 1))}.border-l-accent{--tw-border-opacity:1;border-left-color:rgb(234 88 12 / var(--tw-border-opacity, 1))}.bg-accent{--tw-bg-opacity:1;background-color:rgb(234 88 12 / var(--tw-bg-opacity, 1))}.bg-accent\/5{background-color:rgb(234 88 12 / 0.05)}.bg-bg{--tw-bg-opacity:1;background-color:rgb(12 10 9 / var(--tw-bg-opacity, 1))}.bg-bg\/50{background-color:rgb(12 10 9 / 0.5)}.bg-bg\/80{background-color:rgb(12 10 9 / 0.8)}.bg-bg\/95{background-color:rgb(12 10 9 / 0.95)}.bg-black\/80{background-color:rgb(0 0 0 / 0.8)}.bg-black\/90{background-color:rgb(0 0 0 / 0.9)}.bg-red-900\/10{background-color:rgb(127 29 29 / 0.1)}.bg-stone-800{--tw-bg-opacity:1;background-color:rgb(41 37 36 / var(--tw-bg-opacity, 1))}.bg-stone-900{--tw-bg-opacity:1;background-color:rgb(28 25 23 / var(--tw-bg-opacity, 1))}.bg-stone-900\/50{background-color:rgb(28 25 23 / 0.5)}.bg-stone-950{--tw-bg-opacity:1;background-color:rgb(12 10 9 / var(--tw-bg-opacity, 1))}.bg-surface{--tw-bg-opacity:1;background-color:rgb(28 25 23 / var(--tw-bg-opacity, 1))}.bg-surface\/30{background-color:rgb(28 25 23 / 0.3)}.bg-transparent{background-color:transparent}.bg-white{--tw-bg-opacity:1;background-color:rgb(255 255 255 / var(--tw-bg-opacity, 1))}.bg-red-900{--tw-bg-opacity:1;background-color:rgb(127 29 29 / var(--tw-bg-opacity, 1))}.bg-gradient-to-r{background-image:linear-gradient(to right, var(--tw-gradient-stops))}.bg-gradient-to-t{background-image:linear-gradient(to top, var(--tw-gradient-stops))}.from-bg{--tw-gradient-from:#0c0a09 var(--tw-gradient-from-position);--tw-gradient-to:rgb(12 10 9 / 0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from), var(--tw-gradient-to)}.from-stone-900{--tw-gradient-from:#1c1917 var(--tw-gradient-from-position);--tw-gradient-to:rgb(28 25 23 / 0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from), var(--tw-gradient-to)}.via-bg{--tw-gradient-to:rgb(12 10 9 / 0)  var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from), #0c0a09 var(--tw-gradient-via-position), var(--tw-gradient-to)}.to-transparent{--tw-gradient-to:transparent var(--tw-gradient-to-position)}.fill-current{fill:currentColor}.stroke-text{stroke:#e7e5e4}.stroke-white{stroke:#fff}.p-2{padding:0.5rem}.p-3{padding:0.75rem}.p-4{padding:1rem}.p-6{padding:1.5rem}.p-8{padding:2rem}.p-1{padding:0.25rem}.px-4{padding-left:1rem;padding-right:1rem}.px-6{padding-left:1.5rem;padding-right:1.5rem}.px-8{padding-left:2rem;padding-right:2rem}.py-1{padding-top:0.25rem;padding-bottom:0.25rem}.py-2{padding-top:0.5rem;padding-bottom:0.5rem}.py-3{padding-top:0.75rem;padding-bottom:0.75rem}.py-4{padding-top:1rem;padding-bottom:1rem}.px-3{padding-left:0.75rem;padding-right:0.75rem}.pb-2{padding-bottom:0.5rem}.pb-8{padding-bottom:2rem}.pb-96{padding-bottom:24rem}.pl-11{padding-left:2.75rem}.pl-2{padding-left:0.5rem}.pt-3{padding-top:0.75rem}.pt-8{padding-top:2rem}.pr-2{padding-right:0.5rem}.text-left{text-align:left}.text-center{text-align:center}.align-middle{vertical-align:middle}.font-mono{font-family:JetBrains Mono, monospace}.text-3xl{font-size:1.875rem;line-height:2.25rem}.text-4xl{font-size:2.25rem;line-height:2.5rem}.text-5xl{font-size:3rem;line-height:1}.text-\[10px\]{font-size:10px}.text-\[120px\]{font-size:120px}.text-\[9px\]{font-size:9px}.text-lg{font-size:1.125rem;line-height:1.75rem}.text-sm{font-size:0.875rem;line-height:1.25rem}.text-xl{font-size:1.25rem;line-height:1.75rem}.text-xs{font-size:0.75rem;line-height:1rem}.font-black{font-weight:900}.font-bold{font-weight:700}.uppercase{text-transform:uppercase}.italic{font-style:italic}.leading-none{line-height:1}.leading-relaxed{line-height:1.625}.tracking-\[0\.5em\]{letter-spacing:0.5em}.tracking-tight{letter-spacing:-0.025em}.tracking-tighter{letter-spacing:-0.05em}.tracking-wider{letter-spacing:0.05em}.tracking-widest{letter-spacing:0.1em}.text-accent{--tw-text-opacity:1;color:rgb(234 88 12 / var(--tw-text-opacity, 1))}.text-bg{--tw-text-opacity:1;color:rgb(12 10 9 / var(--tw-text-opacity, 1))}.text-black{--tw-text-opacity:1;color:rgb(0 0 0 / var(--tw-text-opacity, 1))}.text-red-900{--tw-text-opacity:1;color:rgb(127 29 29 / var(--tw-text-opacity, 1))}.text-stone-200{--tw-text-opacity:1;color:rgb(231 229 228 / var(--tw-text-opacity, 1))}.text-stone-300{--tw-text-opacity:1;color:rgb(214 211 209 / var(--tw-text-opacity, 1))}.text-stone-400{--tw-text-opacity:1;color:rgb(168 162 158 / var(--tw-text-opacity, 1))}.text-stone-500{--tw-text-opacity:1;color:rgb(120 113 108 / var(--tw-text-opacity, 1))}.text-stone-600{--tw-text-opacity:1;color:rgb(87 83 78 / var(--tw-text-opacity, 1))}.text-stone-700{--tw-text-opacity:1;color:rgb(68 64 60 / var(--tw-text-opacity, 1))}.text-stone-900{--tw-text-opacity:1;color:rgb(28 25 23 / var(--tw-text-opacity, 1))}.text-transparent{color:transparent}.text-white{--tw-text-opacity:1;color:rgb(255 255 255 / var(--tw-text-opacity, 1))}.antialiased{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.placeholder-stone-600::placeholder{--tw-placeholder-opacity:1;color:rgb(87 83 78 / var(--tw-placeholder-opacity, 1))}.opacity-0{opacity:0}.opacity-10{opacity:0.1}.opacity-20{opacity:0.2}.opacity-50{opacity:0.5}.shadow-\[0_0_100px_rgba\(234\2c 88\2c 12\2c 0\.1\)\]{--tw-shadow:0 0 100px rgba(234,88,12,0.1);--tw-shadow-colored:0 0 100px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.shadow-\[0_0_20px_-10px_rgba\(0\2c 0\2c 0\2c 1\)\]{--tw-shadow:0 0 20px -10px rgba(0,0,0,1);--tw-shadow-colored:0 0 20px -10px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.shadow-\[0_0_50px_rgba\(0\2c 0\2c 0\2c 0\.8\)\]{--tw-shadow:0 0 50px rgba(0,0,0,0.8);--tw-shadow-colored:0 0 50px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.shadow-lg{--tw-shadow:0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);--tw-shadow-colored:0 10px 15px -3px var(--tw-shadow-color), 0 4px 6px -4px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.outline-none{outline:2px solid transparent;outline-offset:2px}.backdrop-blur{--tw-backdrop-blur:blur(8px);-webkit-backdrop-filter:var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia);backdrop-filter:var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia)}.backdrop-blur-sm{--tw-backdrop-blur:blur(4px);-webkit-backdrop-filter:var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia);backdrop-filter:var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia)}.backdrop-blur-xl{--tw-backdrop-blur:blur(24px);-webkit-backdrop-filter:var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia);backdrop-filter:var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia)}.transition-all{transition-property:all;transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1);transition-duration:150ms}.transition-colors{transition-property:color, background-color, border-color, fill, stroke, -webkit-text-decoration-color;transition-property:color, background-color, border-color, text-decoration-color, fill, stroke;transition-property:color, background-color, border-color, text-decoration-color, fill, stroke, -webkit-text-decoration-color;transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1);transition-duration:150ms}.transition-opacity{transition-property:opacity;transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1);transition-duration:150ms}.transition-transform{transition-property:transform;transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1);transition-duration:150ms}.delay-700{transition-delay:700ms}.duration-300{transition-duration:300ms}.ease-in-out{transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1)}
        :root {
            --grid-color: rgba(231, 229, 228, 0.05);
        }
        
        body {
            background-color: #0c0a09;
            background-image: 
                linear-gradient(var(--grid-color) 1px, transparent 1px),
                linear-gradient(90deg, var(--grid-color) 1px, transparent 1px);
            background-size: 40px 40px;
            color: #e7e5e4;
        }

        .raw-border { border: 2px solid #44403c; }
        .raw-border-focus:focus-within { border-color: #ea580c; }
        
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #0c0a09; }
        ::-webkit-scrollbar-thumb { background: #292524; }
        ::-webkit-scrollbar-thumb:hover { background: #ea580c; }

        input[type=range] {
            -webkit-appearance: none;
            width: 100%;
            background: transparent;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 16px;
            width: 16px;
            background: #ea580c;
            margin-top: -6px;
            cursor: pointer;
            border: 2px solid #0c0a09;
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            cursor: pointer;
            background: #292524;
        }
        input[type=range]:focus::-webkit-slider-runnable-track {
            background: #44403c;
        }

        .hover-invert { transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1); }
        .hover-invert:hover {
            background-color: #e7e5e4;
            color: #0c0a09;
            border-color: #e7e5e4;
        }
        .hover-invert:hover * { color: #0c0a09; stroke: #0c0a09; }

        .bracket-box { position: relative; }
        .bracket-box::before, .bracket-box::after {
            content: '';
            position: absolute;
            width: 6px;
            height: 6px;
            border-color: #ea580c;
            border-style: solid;
            transition: all 0.2s ease;
            opacity: 0;
        }
        .bracket-box::before { top: -1px; left: -1px; border-width: 2px 0 0 2px; }
        .bracket-box::after { bottom: -1px; right: -1px; border-width: 0 2px 2px 0; }
        
        @keyframes pulse-slow {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .animate-pulse-slow { animation: pulse-slow 3s cubic-bezier(0.4, 0, 0.6, 1) infinite; }

        .model-tab{cursor:pointer;border-top-width:1px;border-left-width:1px;border-right-width:1px;border-color:transparent;padding-left:0.75rem;padding-right:0.75rem;padding-top:0.25rem;padding-bottom:0.25rem;font-family:JetBrains Mono, monospace;font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:0.1em;--tw-text-opacity:1;color:rgb(87 83 78 / var(--tw-text-opacity, 1));transition-property:all;transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1);transition-duration:150ms}
        .model-tab.active{z-index:10;--tw-translate-y:1px;transform:translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y));border-color:rgb(41 37 36 / var(--tw-border-opacity, 1));--tw-border-opacity:1;border-bottom-color:rgb(12 10 9 / var(--tw-border-opacity, 1));--tw-bg-opacity:1;background-color:rgb(28 25 23 / var(--tw-bg-opacity, 1));--tw-text-opacity:1;color:rgb(234 88 12 / var(--tw-text-opacity, 1))}
        .model-tab:hover:not(.active){--tw-bg-opacity:1;background-color:rgb(28 25 23 / var(--tw-bg-opacity, 1));--tw-text-opacity:1;color:rgb(168 162 158 / var(--tw-text-opacity, 1))}

        .wrapped-gradient-text {
            background: linear-gradient(90deg, #ea580c 0%, #84cc16 50%, #ea580c 100%);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            background-size: 200% auto;
            animation: wrapped-shine 3s linear infinite;
        }
        @keyframes wrapped-shine {
            to { background-position: 200% center; }
        }
        .card-enter {
            animation: card-slide-up 0.8s cubic-bezier(0.16, 1, 0.3, 1) forwards;
            opacity: 0;
            transform: translateY(20px);
        }
        @keyframes card-slide-up {
            to { opacity: 1; transform: translateY(0); }
        }

        /* =============================================
           MARKDOWN RENDERING STYLES
           Scoped to .md-body for system (AI) messages
           ============================================= */

        .md-body {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.875rem;
            line-height: 1.75;
            color: #d6d3d1; /* stone-300 */
        }

        /* Headings */
        .md-body h1,
        .md-body h2,
        .md-body h3,
        .md-body h4,
        .md-body h5,
        .md-body h6 {
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: #ea580c; /* accent */
            margin-top: 1.4em;
            margin-bottom: 0.5em;
            line-height: 1.2;
        }
        .md-body h1 { font-size: 1.3rem; border-bottom: 1px solid #44403c; padding-bottom: 0.3em; }
        .md-body h2 { font-size: 1.1rem; }
        .md-body h3 { font-size: 0.95rem; color: #fb923c; }
        .md-body h4, .md-body h5, .md-body h6 { font-size: 0.85rem; color: #fdba74; }

        /* Paragraphs */
        .md-body p {
            margin-bottom: 0.85em;
            color: #d6d3d1;
        }
        .md-body p:last-child { margin-bottom: 0; }

        /* Links */
        .md-body a {
            color: #fb923c;
            text-decoration: underline;
            text-underline-offset: 3px;
            transition: color 0.15s;
        }
        .md-body a:hover { color: #ea580c; }

        /* Lists */
        .md-body ul,
        .md-body ol {
            margin: 0.6em 0 0.85em 0;
            padding-left: 1.5em;
        }
        .md-body ul { list-style-type: none; }
        .md-body ul li { position: relative; padding-left: 1.2em; margin-bottom: 0.3em; }
        .md-body ul li::before {
            content: '▸';
            position: absolute;
            left: 0;
            color: #ea580c;
            font-size: 0.75em;
            top: 0.2em;
        }
        .md-body ol { list-style-type: decimal; }
        .md-body ol li { padding-left: 0.3em; margin-bottom: 0.3em; }
        .md-body ol li::marker { color: #ea580c; font-weight: bold; }

        /* Nested lists */
        .md-body ul ul, .md-body ol ol,
        .md-body ul ol, .md-body ol ul {
            margin: 0.2em 0;
        }
        .md-body ul ul li::before { color: #84cc16; content: '◦'; }

        /* Inline code */
        .md-body code:not(pre code) {
            background: #1c1917;
            border: 1px solid #44403c;
            color: #84cc16;
            padding: 0.1em 0.45em;
            border-radius: 0;
            font-size: 0.82em;
            font-family: 'JetBrains Mono', monospace;
        }

        /* Code blocks */
        .md-body pre {
            background: #0c0a09 !important;
            border: 1px solid #44403c;
            border-left: 3px solid #ea580c;
            padding: 1em 1.2em;
            overflow-x: auto;
            margin: 0.85em 0;
            position: relative;
        }
        .md-body pre code {
            background: transparent !important;
            border: none !important;
            padding: 0 !important;
            font-size: 0.82em;
            color: #a8a29e;
            font-family: 'JetBrains Mono', monospace;
        }

        /* Code block language label */
        .md-body pre .code-lang-label {
            position: absolute;
            top: 0;
            right: 0;
            font-size: 0.65rem;
            font-family: 'JetBrains Mono', monospace;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            background: #ea580c;
            color: #0c0a09;
            padding: 1px 8px;
            font-weight: 700;
        }

        /* Copy button for code blocks */
        .md-body pre .copy-btn {
            position: absolute;
            top: 0;
            right: 0;
            font-size: 0.6rem;
            font-family: 'JetBrains Mono', monospace;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            background: #1c1917;
            color: #78716c;
            border: 1px solid #44403c;
            border-top: none;
            border-right: none;
            padding: 3px 10px;
            cursor: pointer;
            transition: all 0.15s;
        }
        .md-body pre .copy-btn:hover {
            background: #ea580c;
            color: #0c0a09;
            border-color: #ea580c;
        }

        /* Blockquote */
        .md-body blockquote {
            border-left: 3px solid #ea580c;
            padding: 0.5em 1em;
            margin: 0.85em 0;
            background: rgba(234, 88, 12, 0.05);
            color: #a8a29e;
            font-style: italic;
        }
        .md-body blockquote p { color: #a8a29e; margin-bottom: 0; }

        /* Horizontal rule */
        .md-body hr {
            border: none;
            border-top: 1px solid #44403c;
            margin: 1.2em 0;
        }

        /* Tables */
        .md-body table {
            width: 100%;
            border-collapse: collapse;
            margin: 0.85em 0;
            font-size: 0.8em;
            overflow-x: auto;
            display: block;
        }
        .md-body thead { background: #1c1917; }
        .md-body th {
            color: #ea580c;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.06em;
            font-size: 0.75em;
            padding: 0.5em 0.8em;
            border: 1px solid #44403c;
            text-align: left;
        }
        .md-body td {
            padding: 0.4em 0.8em;
            border: 1px solid #292524;
            color: #d6d3d1;
            vertical-align: top;
        }
        .md-body tr:nth-child(even) td { background: rgba(28,25,23,0.5); }
        .md-body tr:hover td { background: rgba(234,88,12,0.04); }

        /* Strong / Em */
        .md-body strong { color: #f5f5f4; font-weight: 700; }
        .md-body em { color: #a8a29e; font-style: italic; }

        /* Highlight.js overrides for the theme */
        .hljs { background: transparent !important; }
        .selection\:bg-accent *::selection{--tw-bg-opacity:1;background-color:rgb(234 88 12 / var(--tw-bg-opacity, 1))}
        .selection\:text-white *::selection{--tw-text-opacity:1;color:rgb(255 255 255 / var(--tw-text-opacity, 1))}
        .selection\:bg-accent::selection{--tw-bg-opacity:1;background-color:rgb(234 88 12 / var(--tw-bg-opacity, 1))}
        .selection\:text-white::selection{--tw-text-opacity:1;color:rgb(255 255 255 / var(--tw-text-opacity, 1))}
        .hover\:border-accent:hover{--tw-border-opacity:1;border-color:rgb(234 88 12 / var(--tw-border-opacity, 1))}
        .hover\:border-cyan-500:hover{--tw-border-opacity:1;border-color:rgb(6 182 212 / var(--tw-border-opacity, 1))}
        .hover\:border-lime:hover{--tw-border-opacity:1;border-color:rgb(132 204 22 / var(--tw-border-opacity, 1))}
        .hover\:border-purple-500:hover{--tw-border-opacity:1;border-color:rgb(168 85 247 / var(--tw-border-opacity, 1))}
        .hover\:border-stone-600:hover{--tw-border-opacity:1;border-color:rgb(87 83 78 / var(--tw-border-opacity, 1))}
        .hover\:bg-accent:hover{--tw-bg-opacity:1;background-color:rgb(234 88 12 / var(--tw-bg-opacity, 1))}
        .hover\:bg-orange-500:hover{--tw-bg-opacity:1;background-color:rgb(249 115 22 / var(--tw-bg-opacity, 1))}
        .hover\:bg-stone-800:hover{--tw-bg-opacity:1;background-color:rgb(41 37 36 / var(--tw-bg-opacity, 1))}
        .hover\:bg-surface:hover{--tw-bg-opacity:1;background-color:rgb(28 25 23 / var(--tw-bg-opacity, 1))}
        .hover\:bg-red-700:hover{--tw-bg-opacity:1;background-color:rgb(185 28 28 / var(--tw-bg-opacity, 1))}
        .hover\:text-red-500:hover{--tw-text-opacity:1;color:rgb(239 68 68 / var(--tw-text-opacity, 1))}
        .hover\:text-white:hover{--tw-text-opacity:1;color:rgb(255 255 255 / var(--tw-text-opacity, 1))}
        .hover\:shadow-\[0_0_15px_-3px_rgba\(234\2c 88\2c 12\2c 0\.1\)\]:hover{--tw-shadow:0 0 15px -3px rgba(234,88,12,0.1);--tw-shadow-colored:0 0 15px -3px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}
        .hover\:shadow-\[0_0_15px_-3px_rgba\(234\2c 88\2c 12\2c 0\.3\)\]:hover{--tw-shadow:0 0 15px -3px rgba(234,88,12,0.3);--tw-shadow-colored:0 0 15px -3px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}
        .hover\:shadow-\[0_0_20px_rgba\(234\2c 88\2c 12\2c 0\.5\)\]:hover{--tw-shadow:0 0 20px rgba(234,88,12,0.5);--tw-shadow-colored:0 0 20px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}
        .focus\:border-accent:focus{--tw-border-opacity:1;border-color:rgb(234 88 12 / var(--tw-border-opacity, 1))}
        .focus\:ring-0:focus{--tw-ring-offset-shadow:var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow:var(--tw-ring-inset) 0 0 0 calc(0px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow), var(--tw-ring-shadow), var(--tw-shadow, 0 0 #0000)}
        .group:hover .group-hover\:scale-110{--tw-scale-x:1.1;--tw-scale-y:1.1;transform:translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}
        .group:hover .group-hover\:text-accent{--tw-text-opacity:1;color:rgb(234 88 12 / var(--tw-text-opacity, 1))}
        .group:hover .group-hover\:text-cyan-500{--tw-text-opacity:1;color:rgb(6 182 212 / var(--tw-text-opacity, 1))}
        .group:hover .group-hover\:text-lime{--tw-text-opacity:1;color:rgb(132 204 22 / var(--tw-text-opacity, 1))}
        .group:hover .group-hover\:text-purple-500{--tw-text-opacity:1;color:rgb(168 85 247 / var(--tw-text-opacity, 1))}
        .group:hover .group-hover\:text-white{--tw-text-opacity:1;color:rgb(255 255 255 / var(--tw-text-opacity, 1))}
        .group:hover .group-hover\:opacity-100{opacity:1}
        @media (min-width: 768px){.md\:inline{display:inline}.md\:flex{display:flex}.md\:hidden{display:none}.md\:h-14{height:3.5rem}.md\:max-w-\[75\%\]{max-width:75%}.md\:grid-cols-2{grid-template-columns:repeat(2, minmax(0, 1fr))}.md\:grid-cols-4{grid-template-columns:repeat(4, minmax(0, 1fr))}.md\:gap-10{gap:2.5rem}.md\:p-12{padding:3rem}.md\:text-4xl{font-size:2.25rem;line-height:2.5rem}.md\:text-5xl{font-size:3rem;line-height:1}.md\:text-7xl{font-size:4.5rem;line-height:1}.md\:text-base{font-size:1rem;line-height:1.5rem}.md\:text-xl{font-size:1.25rem;line-height:1.75rem}.md\:text-xs{font-size:0.75rem;line-height:1rem}}
    </style></head>
<body class="h-screen flex flex-col antialiased selection:bg-accent selection:text-white overflow-hidden">

    <!-- Mobile Header -->
    <header class="md:hidden flex items-center justify-between p-4 border-b border-stone-800 bg-bg/95 backdrop-blur">
        <span class="font-black italic text-lg tracking-tighter text-accent">// i3-lab</span>
        <button onclick="SettingsUI.toggle()" class="text-stone-400 hover:text-white"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="settings" aria-hidden="true" class="lucide lucide-settings"><path d="M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915"></path><circle cx="12" cy="12" r="3"></circle></svg></button>
    </header>

    <div class="flex flex-1 overflow-hidden relative">
        
        <!-- SIDEBAR -->
        <aside id="main-sidebar" class="hidden md:flex flex-col border-r border-stone-800 bg-bg/50 backdrop-blur-sm z-20 transition-all duration-300 ease-in-out w-[70px]">
            <div class="p-6 pb-2">
                <button onclick="SidebarUI.toggle()" class="p-2 -ml-2 hover:bg-surface text-stone-400 hover:text-white rounded-none transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="menu" aria-hidden="true" class="lucide lucide-menu w-6 h-6"><path d="M4 5h16"></path><path d="M4 12h16"></path><path d="M4 19h16"></path></svg>
                </button>
            </div>

            <div class="px-4 mb-6 space-y-2 overflow-hidden">
                <button onclick="SessionManager.createNewSession()" class="w-full flex items-center gap-3 px-4 py-3 bg-surface hover:bg-stone-800 border border-stone-700 hover:border-accent transition-all group whitespace-nowrap">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="plus" aria-hidden="true" class="lucide lucide-plus w-4 h-4 text-stone-500 group-hover:text-accent shrink-0"><path d="M5 12h14"></path><path d="M12 5v14"></path></svg>
                    <span class="sidebar-text font-mono text-xs font-bold uppercase tracking-widest text-stone-300 group-hover:text-white hidden">New_Session</span>
                </button>
            </div>

            <div id="wrapped-sidebar-btn" class="hidden px-4 mb-6 transition-all">
                <button onclick="WrappedUI.open()" class="w-full flex items-center gap-3 px-4 py-2 bg-gradient-to-r from-stone-900 to-transparent border border-accent/30 hover:border-accent hover:shadow-[0_0_15px_-3px_rgba(234,88,12,0.3)] transition-all group whitespace-nowrap relative overflow-hidden">
                    <div class="absolute inset-0 bg-accent/5 opacity-0 group-hover:opacity-100 transition-opacity"></div>
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="gift" aria-hidden="true" class="lucide lucide-gift w-3 h-3 text-accent group-hover:scale-110 transition-transform relative z-10"><path d="M12 7v14"></path><path d="M20 11v8a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2v-8"></path><path d="M7.5 7a1 1 0 0 1 0-5A4.8 8 0 0 1 12 7a4.8 8 0 0 1 4.5-5 1 1 0 0 1 0 5"></path><rect x="3" y="7" width="18" height="4" rx="1"></rect></svg>
                    <span id="wrapped-btn-text" class="sidebar-text font-mono text-[10px] font-bold uppercase tracking-widest text-accent relative z-10 hidden">2026 WRAPPED</span>
                </button>
            </div>

            <div class="flex-1 overflow-y-auto px-4 space-y-1 overflow-x-hidden">
                <div class="sidebar-text font-mono text-[10px] text-stone-600 uppercase tracking-widest mb-3 mt-2 pl-2 border-l border-stone-800 flex justify-between items-center whitespace-nowrap hidden">
                    <span>Recent_Logs</span>
                    <button onclick="SessionManager.clearAllData()" class="text-[9px] hover:text-red-500 cursor-pointer" title="Clear Local Storage">[WIPE_MEM]</button>
                </div>
                <div id="session-list" class="sidebar-text space-y-1 hidden"><div class="group flex items-center w-full border-l-2 transition-all font-mono text-white border-l-accent bg-stone-800 cursor-pointer">
                        <button onclick="SessionManager.loadSession('sys_mlv8kwni')" class="flex-1 text-left px-3 py-2 text-xs truncate outline-none">
                            <span class="truncate text-[9px] opacity-50 mr-1">[GROQ]</span>
                            <span class="truncate">&gt; Brainstorm ideas for a ne...</span>
                        </button>
                        <div class="flex items-center gap-2 pr-2">
                            <span class="w-1.5 h-1.5 bg-accent rounded-full animate-pulse"></span>
                            <button onclick="event.stopPropagation(); SessionManager.deleteSession('sys_mlv8kwni')" class="text-stone-500 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-opacity duration-300 delay-700 p-1">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="trash-2" aria-hidden="true" class="lucide lucide-trash-2 w-3 h-3"><path d="M10 11v6"></path><path d="M14 11v6"></path><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"></path><path d="M3 6h18"></path><path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>
                            </button>
                        </div>
                    </div></div>
            </div>

            <div class="mt-auto bg-bg/80 mb-6 overflow-hidden border-t border-stone-800">
                <button onclick="SettingsUI.toggle()" class="w-full flex items-center gap-3 px-4 py-4 text-stone-400 hover:text-white hover:bg-surface transition-colors whitespace-nowrap">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="settings" aria-hidden="true" class="lucide lucide-settings w-4 h-4 shrink-0"><path d="M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915"></path><circle cx="12" cy="12" r="3"></circle></svg>
                    <span class="sidebar-text font-mono text-xs font-bold uppercase tracking-widest hidden">Settings</span>
                </button>
            </div>
        </aside>

        <!-- MAIN CONTENT AREA -->
        <main class="flex-1 flex flex-col relative w-full overflow-hidden">

            <div id="chat-scroll-area" class="flex-1 overflow-y-auto w-full flex flex-col items-center pt-8 pb-96">
                
                <div id="welcome-section" class="w-full max-w-4xl px-4 flex flex-col gap-8 md:gap-10 mt-[10vh] hidden">
                    <div class="space-y-2">
                        <div class="flex items-center gap-3 mb-2">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="terminal" aria-hidden="true" class="lucide lucide-terminal w-8 h-8 text-accent animate-pulse-slow"><path d="M12 19h8"></path><path d="m4 17 6-6-6-6"></path></svg>
                            <h1 class="text-4xl md:text-5xl font-black tracking-tighter uppercase">
                                <span class="text-transparent stroke-white" style="-webkit-text-stroke: 1px #78716c;">Hello, </span>
                                <span class="scramble text-accent" data-text="USER">USER</span>
                            </h1>
                        </div>
                        <p class="font-mono text-stone-500 text-lg md:text-xl pl-11 border-l-2 border-stone-800">
                            Neural uplink ready. Groq Compound-Mini architecture online.
                        </p>
                    </div>

                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 pl-11">
                        <button class="bracket-box text-left p-4 border border-stone-800 bg-surface/30 hover:bg-surface group transition-all" onclick="ChatUI.setInput('Generate a system architecture diagram for a neural network')">
                            <div class="flex items-start justify-between mb-2">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="image" aria-hidden="true" class="lucide lucide-image w-5 h-5 text-stone-500 group-hover:text-accent transition-colors"><rect width="18" height="18" x="3" y="3" rx="2" ry="2"></rect><circle cx="9" cy="9" r="2"></circle><path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"></path></svg>
                                <span class="font-mono text-[10px] text-stone-600 opacity-0 group-hover:opacity-100">CMD_01</span>
                            </div>
                            <span class="font-mono text-xs font-bold text-stone-300 group-hover:text-white block">Generate Arch</span>
                        </button>
                        <button class="bracket-box text-left p-4 border border-stone-800 bg-surface/30 hover:bg-surface group transition-all" onclick="ChatUI.setInput('Debug this python error: IndexError: list index out of range')">
                            <div class="flex items-start justify-between mb-2">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="code-2" aria-hidden="true" class="lucide lucide-code-2 w-5 h-5 text-stone-500 group-hover:text-accent transition-colors"><path d="m18 16 4-4-4-4"></path><path d="m6 8-4 4 4 4"></path><path d="m14.5 4-5 16"></path></svg>
                                <span class="font-mono text-[10px] text-stone-600 opacity-0 group-hover:opacity-100">CMD_02</span>
                            </div>
                            <span class="font-mono text-xs font-bold text-stone-300 group-hover:text-white block">Debug Code</span>
                        </button>
                        <button class="bracket-box text-left p-4 border border-stone-800 bg-surface/30 hover:bg-surface group transition-all" onclick="ChatUI.setInput('Brainstorm ideas for a new transformer architecture')">
                            <div class="flex items-start justify-between mb-2">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="brain-circuit" aria-hidden="true" class="lucide lucide-brain-circuit w-5 h-5 text-stone-500 group-hover:text-accent transition-colors"><path d="M12 5a3 3 0 1 0-5.997.125 4 4 0 0 0-2.526 5.77 4 4 0 0 0 .556 6.588A4 4 0 1 0 12 18Z"></path><path d="M9 13a4.5 4.5 0 0 0 3-4"></path><path d="M6.003 5.125A3 3 0 0 0 6.401 6.5"></path><path d="M3.477 10.896a4 4 0 0 1 .585-.396"></path><path d="M6 18a4 4 0 0 1-1.967-.516"></path><path d="M12 13h4"></path><path d="M12 18h6a2 2 0 0 1 2 2v1"></path><path d="M12 8h8"></path><path d="M16 8V5a2 2 0 0 1 2-2"></path><circle cx="16" cy="13" r=".5"></circle><circle cx="18" cy="3" r=".5"></circle><circle cx="20" cy="21" r=".5"></circle><circle cx="20" cy="8" r=".5"></circle></svg>
                                <span class="font-mono text-[10px] text-stone-600 opacity-0 group-hover:opacity-100">CMD_03</span>
                            </div>
                            <span class="font-mono text-xs font-bold text-stone-300 group-hover:text-white block">Brainstorm</span>
                        </button>
                        <button class="bracket-box text-left p-4 border border-stone-800 bg-surface/30 hover:bg-surface group transition-all" onclick="ChatUI.setInput('Summarize the key differences between RNNs and Transformers')">
                            <div class="flex items-start justify-between mb-2">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="graduation-cap" aria-hidden="true" class="lucide lucide-graduation-cap w-5 h-5 text-stone-500 group-hover:text-accent transition-colors"><path d="M21.42 10.922a1 1 0 0 0-.019-1.838L12.83 5.18a2 2 0 0 0-1.66 0L2.6 9.08a1 1 0 0 0 0 1.832l8.57 3.908a2 2 0 0 0 1.66 0z"></path><path d="M22 10v6"></path><path d="M6 12.5V16a6 3 0 0 0 12 0v-3.5"></path></svg>
                                <span class="font-mono text-[10px] text-stone-600 opacity-0 group-hover:opacity-100">CMD_04</span>
                            </div>
                            <span class="font-mono text-xs font-bold text-stone-300 group-hover:text-white block">Summarize</span>
                        </button>
                    </div>
                </div>

                <div id="chat-history" class="w-full flex flex-col gap-6 px-4 mb-12"><div id="msg-1771613030657902b6380e720f" class="flex w-full group relative transition-opacity duration-300 justify-end">
                    <div class="flex items-start gap-4 max-w-[85%] md:max-w-[75%] flex-row-reverse relative">
                        <div class="w-8 h-8 shrink-0 bg-stone-800 flex items-center justify-center text-xs font-mono text-stone-400 select-none">USR</div>
                        <div class="p-4 bg-stone-800 text-stone-200 border border-stone-700 overflow-hidden font-mono text-sm shadow-lg leading-relaxed break-words">
                            <div class="message-content min-h-[1.5em]">Brainstorm ideas for a new transformer architecture.</div>
                        </div>
                    </div></div><div id="msg-17716130306646120217a69fb48" class="flex w-full group relative transition-opacity duration-300 justify-start">
                    <div class="flex items-start gap-4 max-w-[85%] md:max-w-[75%] flex-row relative">
                        <div class="w-8 h-8 shrink-0 bg-accent flex items-center justify-center text-xs font-mono text-bg font-bold select-none">GROQ</div>
                        <div class="p-4 bg-transparent border border-accent/50 relative overflow-hidden shadow-lg leading-relaxed break-words">
                            <div class="message-content min-h-[1.5em]"><div class="md-body"><p>Below is a grab‑bag of “building‑block” ideas you can mix‑and‑match to sketch a next‑generation Transformer.  Think of each bullet as a modular tweak that can be combined, stacked, or turned on/off depending on the target use‑case (LLM, vision, multimodal, edge, etc.).</p>
<hr>
<h2>1. <strong>Attention Variants</strong></h2>
<table>
<thead>
<tr>
<th>Idea</th>
<th>Core Concept</th>
<th>Why It Helps</th>
</tr>
</thead>
<tbody><tr>
<td><strong>Sparse‑Local + Global Hybrid</strong></td>
<td>Split each head into a <em>local</em> window (e.g., 7‑21 tokens) and a <em>global</em> set of learned “summary” tokens that attend everywhere.</td>
<td>Keeps O(N·W) cost for most tokens while still allowing long‑range dependencies via a few global pivots.</td>
</tr>
<tr>
<td><strong>Dynamic Routing Attention</strong></td>
<td>Use a lightweight routing network (e.g., a 2‑layer MLP) to decide, per query, which subset of keys to attend to (learned sparsity pattern).</td>
<td>Reduces FLOPs and memory; the router can adapt to content (e.g., focus on syntax vs. semantics).</td>
</tr>
<tr>
<td><strong>Linear‑Complexity Kernelized Attention</strong></td>
<td>Replace softmax with a positive‑definite kernel (e.g., FAVOR+, Performer, or a learned kernel) that factorises the attention matrix.</td>
<td>Guarantees O(N) memory/time while preserving expressive power.</td>
</tr>
<tr>
<td><strong>Memory‑Compressed Attention</strong></td>
<td>Periodically compress past hidden states into a fixed‑size memory bank (e.g., via a learnable pooling or auto‑encoder).</td>
<td>Enables very long contexts without quadratic blow‑up.</td>
</tr>
<tr>
<td><strong>Cross‑Modal Attention Heads</strong></td>
<td>Dedicated heads that attend only to a different modality (e.g., vision ↔ text) while other heads stay intra‑modal.</td>
<td>Encourages specialized inter‑modal alignment without forcing every head to do both.</td>
</tr>
</tbody></table>
<hr>
<h2>2. <strong>Token‑Level Adaptivity</strong></h2>
<table>
<thead>
<tr>
<th>Idea</th>
<th>Mechanism</th>
<th>Benefits</th>
</tr>
</thead>
<tbody><tr>
<td><strong>Adaptive Token Pruning</strong></td>
<td>After each layer, a lightweight classifier predicts “important vs. filler” tokens; low‑importance tokens are dropped or merged.</td>
<td>Cuts sequence length on‑the‑fly, saving compute for long inputs (e.g., documents).</td>
</tr>
<tr>
<td><strong>Learned Token Merging (Pooling)</strong></td>
<td>Use a differentiable clustering (e.g., Gumbel‑Softmax) to merge similar tokens into a single representation.</td>
<td>Provides hierarchical abstraction early, reducing depth needed for high‑level reasoning.</td>
</tr>
<tr>
<td><strong>Dynamic Depth per Token</strong></td>
<td>Each token carries a “stop‑gate” that decides whether to continue through further transformer blocks (similar to Universal Transformers).</td>
<td>Allows easy tokens (e.g., stop‑words) to exit early, saving compute.</td>
</tr>
<tr>
<td><strong>Token‑Specific Positional Encodings</strong></td>
<td>Instead of a static sinusoid, generate position embeddings conditioned on token type or content (via a small MLP).</td>
<td>Gives the model richer spatial/temporal cues, especially for irregular data (e.g., code).</td>
</tr>
</tbody></table>
<hr>
<h2>3. <strong>Layer‑Level Innovations</strong></h2>
<table>
<thead>
<tr>
<th>Idea</th>
<th>Description</th>
<th>Expected Impact</th>
</tr>
</thead>
<tbody><tr>
<td><strong>Mixture‑of‑Experts (MoE) Feed‑Forward</strong></td>
<td>Split the FFN into many expert sub‑networks; a gating network routes each token to the top‑k experts.</td>
<td>Massive parameter scaling with modest compute (as in GLaM, Switch‑Transformer).</td>
</tr>
<tr>
<td><strong>Parallel‑Branch Architecture</strong></td>
<td>Two parallel branches per block: (a) a cheap “linear” branch (e.g., depth‑wise conv) and (b) a full‑blown attention branch; their outputs are summed.</td>
<td>Provides a cheap “baseline” path for easy patterns, reserving expensive attention for hard cases.</td>
</tr>
<tr>
<td><strong>Reversible Layers</strong></td>
<td>Use reversible residual connections (e.g., RevNet style) so activations need not be stored for back‑prop.</td>
<td>Cuts memory roughly in half, enabling deeper models on the same hardware.</td>
</tr>
<tr>
<td><strong>Layer‑Norm Alternatives</strong></td>
<td>Replace LayerNorm with RMSNorm, ScaleNorm, or a learned normalization that can be turned off per layer.</td>
<td>Reduces compute and sometimes improves stability for very deep stacks.</td>
</tr>
<tr>
<td><strong>Self‑Conditioning</strong></td>
<td>Feed the output of the previous block as an additional bias term into the current block’s attention logits.</td>
<td>Encourages smoother evolution of representations across layers.</td>
</tr>
</tbody></table>
<hr>
<h2>4. <strong>Parameter‑Sharing &amp; Efficient Scaling</strong></h2>
<table>
<thead>
<tr>
<th>Idea</th>
<th>How It Works</th>
<th>When It Helps</th>
</tr>
</thead>
<tbody><tr>
<td><strong>ALiBi‑Style Linear Biases</strong></td>
<td>Add a linearly increasing bias to attention scores (no absolute positional embeddings).</td>
<td>Enables extrapolation to longer sequences without extra parameters.</td>
</tr>
<tr>
<td><strong>Cross‑Layer Weight Tying</strong></td>
<td>Share the FFN weights across every <em>N</em> layers (e.g., every 4th layer).</td>
<td>Reduces parameter count while preserving depth; useful for on‑device models.</td>
</tr>
<tr>
<td><strong>Low‑Rank Factorised Projections</strong></td>
<td>Factorise Q/K/V projection matrices into two smaller matrices (e.g., 1024→256→1024).</td>
<td>Cuts FLOPs and memory, especially for very wide models.</td>
</tr>
<tr>
<td><strong>Quantisation‑Aware Training (QAT) + Mixed‑Precision</strong></td>
<td>Train with simulated 8‑bit weights/activations, then deploy with INT8 kernels.</td>
<td>Gains 2‑4× speed on modern LPU/TPU hardware without large accuracy loss.</td>
</tr>
</tbody></table>
<hr>
<h2>5. <strong>Multimodal &amp; Structured Extensions</strong></h2>
<table>
<thead>
<tr>
<th>Idea</th>
<th>Sketch</th>
</tr>
</thead>
<tbody><tr>
<td><strong>Unified Token Space</strong></td>
<td>Encode text, image patches, audio frames, and graph nodes into a common embedding space; use a single shared Transformer.</td>
</tr>
<tr>
<td><strong>Structure‑Aware Biases</strong></td>
<td>Inject bias terms that encode known structure (e.g., tree depth for ASTs, grid coordinates for images).</td>
</tr>
<tr>
<td><strong>Cross‑Attention Routing</strong></td>
<td>For each modality pair, learn a routing matrix that decides which heads attend across modalities and which stay intra‑modal.</td>
</tr>
</tbody></table>
<hr>
<h2>6. <strong>Training‑Time Tricks That Shape Architecture</strong></h2>
<table>
<thead>
<tr>
<th>Idea</th>
<th>What to Add</th>
<th>Why</th>
</tr>
</thead>
<tbody><tr>
<td><strong>Curriculum‑Based Length Scaling</strong></td>
<td>Start training on short sequences, gradually increase max length.</td>
<td>Lets the model learn local patterns first, then long‑range dependencies, reducing instability.</td>
</tr>
<tr>
<td><strong>Layer‑Drop + Stochastic Depth</strong></td>
<td>Randomly drop entire layers during training.</td>
<td>Encourages robustness to depth variations; at inference you can optionally prune layers.</td>
</tr>
<tr>
<td><strong>Self‑Supervised Auxiliary Heads</strong></td>
<td>Add a small MLM or contrastive head on intermediate layers.</td>
<td>Forces earlier layers to learn useful representations, improving downstream fine‑tuning.</td>
</tr>
<tr>
<td><strong>Meta‑Learning of Hyper‑Parameters</strong></td>
<td>Use a small outer loop to learn optimal sparsity ratios, gating thresholds, or expert counts.</td>
<td>Automates the search for the best trade‑off between speed and accuracy.</td>
</tr>
</tbody></table>
<hr>
<h2>7. <strong>Putting It All Together – Example Blueprint</strong></h2>
<p>Below is a concrete “starter” architecture that combines several of the ideas above. Feel free to swap components in/out.</p>
<pre class="relative group/pre">                        
                        <button class="copy-btn" onclick="ChatUI.copyCode(this)" data-code="Input → Token Embedding + (learned) Positional Bias (ALiBi) → 
[ Block × L ] where each Block = {
    1️⃣  Adaptive Token Pruning (keep top‑p% tokens)
    2️⃣  Parallel Branches:
        a) Sparse‑Local + Global Hybrid Attention (2 heads local, 2 heads global)
        b) MoE Feed‑Forward (4 experts, top‑2 gating)
    3️⃣  Residual Add + RMSNorm
    4️⃣  Optional Reversible Wrapper (if memory‑critical)
}
→ Token Un‑pruning (re‑inject dropped tokens as zero‑vectors or learned “placeholder” embeddings)
→ Final LayerNorm → Output Head(s)

Training tricks:
- Curriculum length (8 → 2048 tokens)
- Layer‑Drop (p=0.1)
- Mixed‑precision + QAT for deployment">COPY</button>
                        <code class="hljs">Input → Token Embedding + (learned) Positional <span class="hljs-title function_">Bias</span> <span class="hljs-params">(ALiBi)</span> → 
[ Block × L ] where <span class="hljs-type">each</span> <span class="hljs-variable">Block</span> <span class="hljs-operator">=</span> {
    <span class="hljs-number">1</span>️⃣  Adaptive Token <span class="hljs-title function_">Pruning</span> <span class="hljs-params">(keep top‑p% tokens)</span>
    <span class="hljs-number">2</span>️⃣  Parallel Branches:
        a) Sparse‑Local + Global Hybrid <span class="hljs-title function_">Attention</span> <span class="hljs-params">(<span class="hljs-number">2</span> heads local, <span class="hljs-number">2</span> heads global)</span>
        b) MoE Feed‑Forward (<span class="hljs-number">4</span> experts, top‑<span class="hljs-number">2</span> gating)
    <span class="hljs-number">3</span>️⃣  Residual Add + RMSNorm
    <span class="hljs-number">4</span>️⃣  Optional Reversible <span class="hljs-title function_">Wrapper</span> <span class="hljs-params">(<span class="hljs-keyword">if</span> memory‑critical)</span>
}
→ Token Un‑pruning (re‑inject dropped tokens as zero‑vectors or learned “placeholder” embeddings)
→ Final LayerNorm → Output <span class="hljs-title function_">Head</span><span class="hljs-params">(s)</span>

Training tricks:
- Curriculum <span class="hljs-title function_">length</span> <span class="hljs-params">(<span class="hljs-number">8</span> → <span class="hljs-number">2048</span> tokens)</span>
- Layer‑Drop (p=<span class="hljs-number">0.1</span>)
- Mixed‑precision + QAT <span class="hljs-keyword">for</span> deployment</code>
                    </pre><p><strong>Key properties</strong></p>
<ul>
<li><strong>Quadratic → Near‑Linear</strong>: Local windows keep most attention O(N·W); global tokens give long‑range context with only a few extra keys.</li>
<li><strong>Compute‑Adaptive</strong>: Pruning + dynamic depth means cheap inputs finish quickly; heavy inputs get more processing.</li>
<li><strong>Scalable Parameters</strong>: MoE FFN provides a huge capacity budget without proportional FLOPs.</li>
<li><strong>Memory‑Efficient</strong>: Reversible layers and token‑level pruning cut activation storage dramatically.</li>
</ul>
<hr>
<h2>8. <strong>Research Directions &amp; Open Questions</strong></h2>
<ol>
<li><strong>Learned Routing Stability</strong> – How to prevent routing collapse where all tokens go to the same expert/head? Consider entropy regularisation or load‑balancing losses.</li>
<li><strong>Dynamic Global Token Management</strong> – Should global summary tokens be static (learned) or generated on‑the‑fly (e.g., via a small pooling network)?</li>
<li><strong>Token‑Pruning Recovery</strong> – When re‑injecting pruned tokens, what is the best representation (zero, learned “pad” token, or a context‑aware placeholder)?</li>
<li><strong>Hardware‑Aware Design</strong> – Align sparsity patterns with the LPU’s vector units (e.g., ensure each attention block processes a multiple of 64 tokens).</li>
<li><strong>Evaluation on Long‑Form Benchmarks</strong> – Test on datasets like PG‑19, LongChat, or video captioning to verify that the hybrid attention truly scales.</li>
</ol>
<hr>
<h3>Quick‑Start Checklist for a Prototype</h3>
<table>
<thead>
<tr>
<th>✅</th>
<th>Step</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>Choose a base hidden size (e.g., 1024) and number of layers (L=12).</td>
</tr>
<tr>
<td>2</td>
<td>Implement <strong>Hybrid Attention</strong>: 4 heads local (window=16) + 2 heads global (learned tokens).</td>
</tr>
<tr>
<td>3</td>
<td>Add a <strong>MoE FFN</strong> with 8 experts, gating top‑2, capacity factor 1.5.</td>
</tr>
<tr>
<td>4</td>
<td>Insert <strong>RMSNorm</strong> after each residual.</td>
</tr>
<tr>
<td>5</td>
<td>Add <strong>Token‑Pruning</strong> after each block (keep 80 % of tokens, based on a simple linear classifier).</td>
</tr>
<tr>
<td>6</td>
<td>Train with <strong>curriculum length</strong> (max 512 → 4096) and <strong>layer‑drop</strong> (0.1).</td>
</tr>
<tr>
<td>7</td>
<td>Validate on a downstream task (e.g., language modeling, image captioning).</td>
</tr>
<tr>
<td>8</td>
<td>Profile on your target LPU; tune window size, number of global tokens, and MoE capacity for the sweet spot.</td>
</tr>
</tbody></table>
<hr>
<h3>TL;DR</h3>
<ul>
<li><strong>Attention</strong>: sparse‑local + a few global tokens, kernelized linear, or routing‑based.</li>
<li><strong>Tokens</strong>: prune/merge adaptively, dynamic depth, content‑aware positions.</li>
<li><strong>Layers</strong>: MoE FFNs, parallel cheap branches, reversible connections, alternative norms.</li>
<li><strong>Scaling</strong>: weight sharing, low‑rank projections, quantisation.</li>
<li><strong>Multimodal</strong>: unified token space + structure‑aware biases + selective cross‑attention.</li>
<li><strong>Training tricks</strong>: curriculum length, layer‑drop, auxiliary heads, meta‑learned sparsity.</li>
</ul>
<p>Mix these ideas in whatever proportion matches your compute budget, latency constraints, and target domain, and you’ll have a fresh transformer family to explore!</p>
</div></div>
                        </div>
                    </div></div></div>
            </div>

            <!-- Bottom Input Area -->
            <div class="absolute bottom-0 left-0 w-full flex justify-center p-4 bg-gradient-to-t from-bg via-bg to-transparent pb-8">
                <div class="w-full max-w-4xl relative group flex flex-col items-start">
                    
                    <div class="flex gap-1 ml-4 relative top-[1px] z-20">
                        <div id="tab-compound-mini" onclick="ChatUI.switchModel('compound-mini')" class="model-tab active">
                            COMPOUND-MINI
                        </div>
                    </div>

                    <div id="text-input-area" class="w-full bg-surface raw-border raw-border-focus p-4 transition-all duration-300 shadow-[0_0_20px_-10px_rgba(0,0,0,1)] hover:shadow-[0_0_15px_-3px_rgba(234,88,12,0.1)] z-10">
                        <textarea id="user-input" class="w-full bg-transparent border-none focus:ring-0 text-stone-200 placeholder-stone-600 resize-none font-mono text-sm md:text-base h-12 md:h-14 py-2 leading-relaxed" placeholder="Enter command..." onkeydown="if(event.key === 'Enter' &amp;&amp; !event.shiftKey) { event.preventDefault(); ChatUI.sendMessage(); }"></textarea>
                        
                        <div class="flex justify-between items-center mt-2 border-t border-stone-800 pt-3">
                            <div class="flex gap-2">
                                <button class="p-2 hover:bg-stone-800 text-stone-500 hover:text-white transition-colors rounded-none border border-transparent hover:border-stone-600">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="image-plus" aria-hidden="true" class="lucide lucide-image-plus w-5 h-5"><path d="M16 5h6"></path><path d="M19 2v6"></path><path d="M21 11.5V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h7.5"></path><path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"></path><circle cx="9" cy="9" r="2"></circle></svg>
                                </button>
                                <button class="p-2 hover:bg-stone-800 text-stone-500 hover:text-white transition-colors rounded-none border border-transparent hover:border-stone-600">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="mic" aria-hidden="true" class="lucide lucide-mic w-5 h-5"><path d="M12 19v3"></path><path d="M19 10v2a7 7 0 0 1-14 0v-2"></path><rect x="9" y="2" width="6" height="13" rx="3"></rect></svg>
                                </button>
                            </div>
                            <div class="flex items-center gap-4">
                                <span class="hidden md:inline font-mono text-[10px] text-stone-600">ENTER TO SEND</span>
                                <button id="send-btn" onclick="ChatUI.sendMessage()" class="text-white p-2 transition-colors w-10 h-10 flex items-center justify-center bg-stone-800 hover:bg-accent">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="arrow-right" aria-hidden="true" id="send-icon" class="lucide lucide-arrow-right lucide-square w-5 h-5"><path d="M5 12h14"></path><path d="m12 5 7 7-7 7"></path></svg>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

             <div class="absolute bottom-4 left-4 text-[120px] font-black text-stone-900 -z-10 select-none opacity-20 pointer-events-none leading-none tracking-tighter">
                AI/SYS
            </div>
        </main>
    </div>

    <!-- Fixed Footer Status Bar -->
    <div class="fixed bottom-0 left-0 w-full bg-bg border-t border-stone-800 z-50 px-4 py-1 flex justify-between items-center text-[10px] md:text-xs font-mono uppercase tracking-widest text-stone-500">
        <div class="flex gap-4">
            <span class="text-accent flex items-center gap-2">
                <span id="status-indicator" class="w-1.5 h-1.5 bg-accent rounded-full animate-ping"></span>
                <span id="status-text">LIVE</span>
            </span>
            <span class="hidden md:inline">API: <span id="current-api-label" class="text-stone-300">GROQ/COMPOUND-MINI</span></span>
            <span class="hidden md:inline">LATENCY: <span id="latency-val">16</span>ms/token</span>
        </div>
        <div>UI VERSION: 3.5 // GROQ</div>
    </div>

    <!-- WRAPPED OVERLAY -->
    <div id="wrapped-overlay" class="fixed inset-0 z-[200] bg-black/90 backdrop-blur-xl hidden flex flex-col items-center justify-center p-4">
        <div class="absolute top-4 right-4 z-50">
            <button onclick="WrappedUI.close()" class="text-stone-500 hover:text-white p-2">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="x" aria-hidden="true" class="lucide lucide-x w-8 h-8"><path d="M18 6 6 18"></path><path d="m6 6 12 12"></path></svg>
            </button>
        </div>
        <div class="relative w-full max-w-2xl bg-stone-950 border-2 border-stone-800 p-8 md:p-12 shadow-[0_0_100px_rgba(234,88,12,0.1)] overflow-hidden card-enter">
            <div class="absolute inset-0 opacity-10 pointer-events-none" style="background-image: linear-gradient(rgba(234, 88, 12, 0.1) 1px, transparent 1px), linear-gradient(90deg, rgba(234, 88, 12, 0.1) 1px, transparent 1px); background-size: 30px 30px;"></div>
            <div class="relative z-10 flex flex-col items-center text-center space-y-8">
                <div class="space-y-2">
                    <div class="font-mono text-xs text-accent tracking-[0.5em] uppercase animate-pulse">Annual System Report</div>
                    <h1 class="text-5xl md:text-7xl font-black italic tracking-tighter wrapped-gradient-text uppercase leading-none">
                        WRAPPED<br><span id="wrapped-title-year" class="text-stone-700 stroke-text">2026</span>
                    </h1>
                </div>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 w-full mt-8">
                    <div class="p-4 bg-stone-900/50 border border-stone-800 flex flex-col items-center group hover:border-accent transition-colors">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="message-square" aria-hidden="true" class="lucide lucide-message-square w-6 h-6 text-stone-600 group-hover:text-accent mb-2"><path d="M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z"></path></svg>
                        <span id="wrap-total-msgs" class="text-3xl font-black text-white">0</span>
                        <span class="text-[9px] font-mono text-stone-500 uppercase tracking-wider">Prompts</span>
                    </div>
                    <div class="p-4 bg-stone-900/50 border border-stone-800 flex flex-col items-center group hover:border-lime transition-colors">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="cpu" aria-hidden="true" class="lucide lucide-cpu w-6 h-6 text-stone-600 group-hover:text-lime mb-2"><path d="M12 20v2"></path><path d="M12 2v2"></path><path d="M17 20v2"></path><path d="M17 2v2"></path><path d="M2 12h2"></path><path d="M2 17h2"></path><path d="M2 7h2"></path><path d="M20 12h2"></path><path d="M20 17h2"></path><path d="M20 7h2"></path><path d="M7 20v2"></path><path d="M7 2v2"></path><rect x="4" y="4" width="16" height="16" rx="2"></rect><rect x="8" y="8" width="8" height="8" rx="1"></rect></svg>
                        <span id="wrap-fav-model" class="text-lg font-bold text-white truncate w-full text-center">GROQ</span>
                        <span class="text-[9px] font-mono text-stone-500 uppercase tracking-wider">Top Arch</span>
                    </div>
                    <div class="p-4 bg-stone-900/50 border border-stone-800 flex flex-col items-center group hover:border-cyan-500 transition-colors">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="history" aria-hidden="true" class="lucide lucide-history w-6 h-6 text-stone-600 group-hover:text-cyan-500 mb-2"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"></path><path d="M3 3v5h5"></path><path d="M12 7v5l4 2"></path></svg>
                        <span id="wrap-sessions" class="text-3xl font-black text-white">0</span>
                        <span class="text-[9px] font-mono text-stone-500 uppercase tracking-wider">Sessions</span>
                    </div>
                    <div class="p-4 bg-stone-900/50 border border-stone-800 flex flex-col items-center group hover:border-purple-500 transition-colors">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="type" aria-hidden="true" class="lucide lucide-type w-6 h-6 text-stone-600 group-hover:text-purple-500 mb-2"><path d="M12 4v16"></path><path d="M4 7V5a1 1 0 0 1 1-1h14a1 1 0 0 1 1 1v2"></path><path d="M9 20h6"></path></svg>
                        <span id="wrap-words" class="text-xl font-bold text-white">0</span>
                        <span class="text-[9px] font-mono text-stone-500 uppercase tracking-wider">Est. Tokens</span>
                    </div>
                </div>
                <div class="w-full border-t border-stone-800 pt-8">
                    <div class="text-[10px] font-mono text-stone-500 mb-2">USER ARCHETYPE DETECTED:</div>
                    <div id="wrap-archetype" class="text-3xl md:text-4xl font-bold text-white uppercase tracking-tight">THE OBSERVER</div>
                    <p id="wrap-archetype-desc" class="text-xs font-mono text-stone-400 mt-2 max-w-md mx-auto">Your interaction patterns suggest a careful, analytical approach to neural interfacing.</p>
                </div>
                <button onclick="WrappedUI.close()" class="px-8 py-3 bg-white text-black font-black font-mono uppercase text-xs hover:bg-accent hover:text-white transition-all hover:shadow-[0_0_20px_rgba(234,88,12,0.5)] mt-4">ACKNOWLEDGE REPORT</button>
            </div>
        </div>
    </div>

    <!-- SETTINGS MODAL -->
    <div id="settings-modal" class="fixed inset-0 z-[100] bg-black/80 backdrop-blur-sm flex items-center justify-center p-4 hidden">
        <div class="w-full max-w-lg bg-bg border border-stone-700 shadow-[0_0_50px_rgba(0,0,0,0.8)] flex flex-col max-h-[90vh]">
            <div class="flex items-center justify-between p-4 border-b border-stone-800 bg-surface">
                <div class="flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="sliders-horizontal" aria-hidden="true" class="lucide lucide-sliders-horizontal w-4 h-4 text-accent"><path d="M10 5H3"></path><path d="M12 19H3"></path><path d="M14 3v4"></path><path d="M16 17v4"></path><path d="M21 12h-9"></path><path d="M21 19h-5"></path><path d="M21 5h-7"></path><path d="M8 10v4"></path><path d="M8 12H3"></path></svg>
                    <h2 class="font-mono text-sm font-bold uppercase tracking-widest text-white">System_Configuration</h2>
                </div>
                <button onclick="SettingsUI.toggle()" class="text-stone-500 hover:text-white"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="x" aria-hidden="true" class="lucide lucide-x w-5 h-5"><path d="M18 6 6 18"></path><path d="m6 6 12 12"></path></svg></button>
            </div>
            <div class="p-6 overflow-y-auto space-y-8">
                <div class="space-y-3 bg-red-900/10 border border-red-900/30 p-4">
                    <div class="flex items-center justify-between">
                         <label class="block font-mono text-xs uppercase text-accent tracking-widest">Groq API Key (Private)</label>
                         <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="lock" aria-hidden="true" class="lucide lucide-lock w-3 h-3 text-stone-500"><rect width="18" height="11" x="3" y="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>
                    </div>
                    <input type="password" id="setting-api-key" class="w-full bg-stone-950 border border-stone-800 focus:border-accent text-stone-300 font-mono text-xs p-3 outline-none" placeholder="gsk_..." onchange="SettingsUI.save()">
                    <p class="text-[10px] text-stone-500 font-mono">Key is stored in your browser's LocalStorage only. Never sent to any server other than Groq.</p>
                </div>
                <div class="space-y-3">
                    <label class="block font-mono text-xs uppercase text-accent tracking-widest">System Prompt (Persona)</label>
                    <textarea id="setting-system-prompt" class="w-full bg-stone-900 border border-stone-800 focus:border-accent text-stone-300 font-mono text-xs p-3 h-32 resize-none outline-none" placeholder="Enter system instructions here..."></textarea>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="space-y-3">
                        <div class="flex justify-between text-xs font-mono">
                            <label class="text-stone-400">TEMPERATURE</label>
                            <span id="val-temp" class="text-accent">1</span>
                        </div>
                        <input type="range" id="setting-temp" min="0.1" max="2.0" step="0.1" value="1.0" oninput="document.getElementById('val-temp').innerText = this.value">
                    </div>
                    <div class="space-y-3">
                        <div class="flex justify-between text-xs font-mono">
                            <label class="text-stone-400">MAX_TOKENS</label>
                            <span id="val-tokens" class="text-accent">1024</span>
                        </div>
                        <input type="range" id="setting-tokens" min="256" max="4096" step="64" value="1024" oninput="document.getElementById('val-tokens').innerText = this.value">
                    </div>
                </div>
            </div>
            <div class="p-4 border-t border-stone-800 bg-surface flex justify-between items-center">
                <button onclick="SettingsUI.reset()" class="text-[10px] font-mono text-red-900 hover:text-red-500 uppercase tracking-wider transition-colors">[RESET_DEFAULTS]</button>
                <div class="flex gap-3">
                    <button onclick="SettingsUI.toggle()" class="px-4 py-2 font-mono text-xs text-stone-400 hover:text-white">CANCEL</button>
                    <button onclick="SettingsUI.save()" class="px-6 py-2 bg-accent text-bg font-bold font-mono text-xs hover:bg-orange-500 transition-colors">SAVE CONFIG</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ── Configure marked + highlight.js ────────────────────────────────────
        marked.setOptions({
            highlight: function(code, lang) {
                if (lang && hljs.getLanguage(lang)) {
                    try { return hljs.highlight(code, { language: lang }).value; } catch (e) {}
                }
                return hljs.highlightAuto(code).value;
            },
            breaks: true,      // single newline → <br>
            gfm: true,         // GitHub-flavoured markdown
            pedantic: false
        });

        // Custom renderer: adds copy buttons + language labels to code blocks
        const renderer = new marked.Renderer();

        renderer.code = function(code, lang, escaped) {
            const highlighted = lang && hljs.getLanguage(lang)
                ? hljs.highlight(code, { language: lang }).value
                : hljs.highlightAuto(code).value;

            const langLabel = lang
                ? `<span class="code-lang-label">${lang.toUpperCase()}</span>`
                : '';

            // Escape for data attribute safely
            const escapedCode = code.replace(/'/g, '&#39;').replace(/"/g, '&quot;');

            return `<pre class="relative group/pre">
                        ${langLabel}
                        <button class="copy-btn" onclick="ChatUI.copyCode(this)" data-code="${escapedCode}">COPY</button>
                        <code class="hljs">${highlighted}</code>
                    </pre>`;
        };

        marked.use({ renderer });

        // ── Sidebar Manager ────────────────────────────────────────────────────
        const SidebarUI = {
            isCollapsed: false,
            toggle: () => {
                const sidebar = document.getElementById('main-sidebar');
                const textElements = document.querySelectorAll('.sidebar-text');
                SidebarUI.isCollapsed = !SidebarUI.isCollapsed;
                if (SidebarUI.isCollapsed) {
                    sidebar.classList.remove('w-[280px]'); sidebar.classList.add('w-[70px]');
                    textElements.forEach(el => el.classList.add('hidden'));
                } else {
                    sidebar.classList.add('w-[280px]'); sidebar.classList.remove('w-[70px]');
                    textElements.forEach(el => el.classList.remove('hidden'));
                }
            }
        };

        // ── Settings Manager ───────────────────────────────────────────────────
        const SettingsUI = {
            defaults: {
                apiKey: "",
                systemPrompt: "You are a helpful, cybernetically enhanced AI assistant.",
                temperature: 1.0,
                maxTokens: 1024
            },
            getSettings: () => {
                const stored = localStorage.getItem('flamefox_settings');
                return stored ? JSON.parse(stored) : SettingsUI.defaults;
            },
            toggle: () => {
                const modal = document.getElementById('settings-modal');
                const isHidden = modal.classList.contains('hidden');
                if (isHidden) {
                    const settings = SettingsUI.getSettings();
                    document.getElementById('setting-api-key').value = settings.apiKey || "";
                    document.getElementById('setting-system-prompt').value = settings.systemPrompt || "";
                    document.getElementById('setting-temp').value = settings.temperature;
                    document.getElementById('val-temp').innerText = settings.temperature;
                    document.getElementById('setting-tokens').value = settings.maxTokens;
                    document.getElementById('val-tokens').innerText = settings.maxTokens;
                    modal.classList.remove('hidden');
                } else {
                    modal.classList.add('hidden');
                }
            },
            reset: () => {
                if(confirm("RESET CONFIG: Restore default system parameters?")) {
                    document.getElementById('setting-api-key').value = "";
                    document.getElementById('setting-system-prompt').value = SettingsUI.defaults.systemPrompt;
                    document.getElementById('setting-temp').value = SettingsUI.defaults.temperature;
                    document.getElementById('val-temp').innerText = SettingsUI.defaults.temperature;
                    document.getElementById('setting-tokens').value = SettingsUI.defaults.maxTokens;
                    document.getElementById('val-tokens').innerText = SettingsUI.defaults.maxTokens;
                    SettingsUI.save();
                }
            },
            save: () => {
                const newSettings = {
                    apiKey: document.getElementById('setting-api-key').value.trim(),
                    systemPrompt: document.getElementById('setting-system-prompt').value.trim(),
                    temperature: parseFloat(document.getElementById('setting-temp').value),
                    maxTokens: parseInt(document.getElementById('setting-tokens').value)
                };
                localStorage.setItem('flamefox_settings', JSON.stringify(newSettings));
                document.getElementById('settings-modal').classList.add('hidden');
                const statusText = document.getElementById('status-text');
                const orig = statusText.innerText;
                statusText.innerText = "CONFIG SAVED";
                setTimeout(() => { statusText.innerText = orig; }, 2000);
            }
        };

        // ── Wrapped UI ─────────────────────────────────────────────────────────
        const WrappedUI = {
            init: () => {
                const now = new Date();
                const year = now.getFullYear();
                const isDecember = now.getMonth() === 11;
                const btnText = document.getElementById('wrapped-btn-text');
                const titleYear = document.getElementById('wrapped-title-year');
                if(btnText) btnText.innerText = `${year} WRAPPED`;
                if(titleYear) titleYear.innerText = year;
                if (isDecember) document.getElementById('wrapped-sidebar-btn').classList.remove('hidden');
                document.addEventListener('keydown', (e) => {
                    if ((e.ctrlKey || e.metaKey) && e.altKey && (e.key === 'w' || e.key === 'W')) {
                        e.preventDefault(); WrappedUI.open();
                    }
                });
            },
            calculateStats: () => {
                const sessions = SessionManager.getSessions();
                let totalMsgs = 0, totalSessions = sessions.length, totalWords = 0;
                sessions.forEach(s => {
                    const userMsgs = s.messages.filter(m => m.role === 'user');
                    totalMsgs += userMsgs.length;
                    userMsgs.forEach(m => { totalWords += m.text.split(' ').length; });
                });
                let archetype = "THE OBSERVER", desc = "Your interaction patterns suggest a careful, analytical approach.";
                if (totalMsgs > 50) { archetype = "THE POWER USER"; desc = "You have integrated the neural link into your daily workflow."; }
                if (totalMsgs === 0) { archetype = "THE GHOST"; desc = "You are here, but you leave no trace. Start chatting to build your profile."; }
                return { totalMsgs, totalSessions, totalWords, topModel: 'GROQ', archetype, desc };
            },
            open: () => {
                const stats = WrappedUI.calculateStats();
                document.getElementById('wrap-total-msgs').innerText = stats.totalMsgs;
                document.getElementById('wrap-sessions').innerText = stats.totalSessions;
                document.getElementById('wrap-words').innerText = Math.floor(stats.totalWords * 1.3);
                document.getElementById('wrap-fav-model').innerText = stats.topModel;
                document.getElementById('wrap-archetype').innerText = stats.archetype;
                document.getElementById('wrap-archetype-desc').innerText = stats.desc;
                document.getElementById('wrapped-overlay').classList.remove('hidden');
            },
            close: () => { document.getElementById('wrapped-overlay').classList.add('hidden'); }
        };

        // ── Session Manager ────────────────────────────────────────────────────
        const SessionManager = {
            STORAGE_KEY: 'flamefox_sessions_v2',
            CURRENT_ID_KEY: 'flamefox_current_id_v2',
            getSessions: () => { const s = localStorage.getItem(SessionManager.STORAGE_KEY); return s ? JSON.parse(s) : []; },
            getCurrentSessionId: () => localStorage.getItem(SessionManager.CURRENT_ID_KEY),
            setCurrentSessionId: (id) => localStorage.setItem(SessionManager.CURRENT_ID_KEY, id),
            saveSession: (session) => {
                const sessions = SessionManager.getSessions();
                const idx = sessions.findIndex(s => s.id === session.id);
                if (idx >= 0) sessions[idx] = session; else sessions.unshift(session);
                localStorage.setItem(SessionManager.STORAGE_KEY, JSON.stringify(sessions));
                SessionManager.renderSessionList();
            },
            createNewSession: () => {
                const newId = 'sys_' + Date.now().toString(36);
                SessionManager.setCurrentSessionId(newId);
                ChatUI.resetUI();
                ChatUI.switchModel('compound-mini');
                SessionManager.renderSessionList();
            },
            deleteSession: (id) => {
                if(!confirm("CONFIRM: Delete this entire session log?")) return;
                let sessions = SessionManager.getSessions().filter(s => s.id !== id);
                localStorage.setItem(SessionManager.STORAGE_KEY, JSON.stringify(sessions));
                if (SessionManager.getCurrentSessionId() === id) SessionManager.createNewSession();
                else SessionManager.renderSessionList();
            },
            loadSession: (id) => {
                const session = SessionManager.getSessions().find(s => s.id === id);
                if (session) { SessionManager.setCurrentSessionId(id); ChatUI.renderChatHistory(session.messages); SessionManager.renderSessionList(); }
            },
            appendMessageToCurrent: (role, text, existingId = null) => {
                let currentId = SessionManager.getCurrentSessionId();
                const sessions = SessionManager.getSessions();
                let session = sessions.find(s => s.id === currentId);
                if (!session) {
                    if(!currentId) { currentId = 'sys_' + Date.now().toString(36); SessionManager.setCurrentSessionId(currentId); }
                    session = { id: currentId, title: text.length > 25 ? text.substring(0, 25) + '...' : text, timestamp: Date.now(), messages: [], modelId: 'compound-mini' };
                }
                if (existingId) {
                    const idx = session.messages.findIndex(m => m.id === existingId);
                    if (idx !== -1) session.messages.splice(idx, 1);
                }
                const msgId = existingId || ('msg-' + Date.now() + Math.random().toString(16).slice(2));
                session.messages.push({ id: msgId, role, text, timestamp: Date.now() });
                SessionManager.saveSession(session);
                return msgId;
            },
            getHistory: () => {
                const currentId = SessionManager.getCurrentSessionId();
                const session = SessionManager.getSessions().find(s => s.id === currentId);
                if (!session) return [];
                return session.messages.filter(m => m.role !== 'system').map(m => ({ role: m.role, content: m.text }));
            },
            clearAllData: () => {
                if(confirm('CONFIRM WIPE: This will delete all local chat history.')) {
                    localStorage.removeItem(SessionManager.STORAGE_KEY);
                    localStorage.removeItem(SessionManager.CURRENT_ID_KEY);
                    localStorage.removeItem('flamefox_settings');
                    location.reload();
                }
            },
            renderSessionList: () => {
                const listEl = document.getElementById('session-list');
                const sessions = SessionManager.getSessions();
                const currentId = SessionManager.getCurrentSessionId();
                if (sessions.length === 0) { listEl.innerHTML = '<div class="text-[10px] text-stone-700 font-mono italic pl-2">NO_LOGS_FOUND</div>'; return; }
                listEl.innerHTML = sessions.map(s => {
                    const isActive = s.id === currentId;
                    const cls = isActive ? 'text-white border-l-accent bg-stone-800' : 'text-stone-400 border-l-transparent hover:text-white hover:border-stone-600 hover:bg-stone-800/50';
                    return `<div class="group flex items-center w-full border-l-2 transition-all font-mono ${cls} cursor-pointer">
                        <button onclick="SessionManager.loadSession('${s.id}')" class="flex-1 text-left px-3 py-2 text-xs truncate outline-none">
                            <span class="truncate text-[9px] opacity-50 mr-1">[GROQ]</span>
                            <span class="truncate">> ${s.title}</span>
                        </button>
                        <div class="flex items-center gap-2 pr-2">
                            ${isActive ? '<span class="w-1.5 h-1.5 bg-accent rounded-full animate-pulse"></span>' : ''}
                            <button onclick="event.stopPropagation(); SessionManager.deleteSession('${s.id}')" class="text-stone-500 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-opacity duration-300 delay-700 p-1">
                                <i data-lucide="trash-2" class="w-3 h-3"></i>
                            </button>
                        </div>
                    </div>`;
                }).join('');
                lucide.createIcons();
            }
        };

        // ── Chat UI Controller ─────────────────────────────────────────────────
        const ChatUI = {
            currentModelKey: 'compound-mini',
            isGenerating: false,
            latencyUpdateInterval: null,
            generationStartTime: null,
            tokenCount: 0,

            // ── Markdown rendering helpers ──────────────────────────────────
            renderMarkdown: (rawText) => {
                // marked.parse returns HTML; wrap in .md-body for scoped styles
                return marked.parse(rawText || '');
            },

            // Copy code helper (called from copy buttons in rendered code blocks)
            copyCode: (btn) => {
                const code = btn.getAttribute('data-code')
                    .replace(/&#39;/g, "'")
                    .replace(/&quot;/g, '"');
                navigator.clipboard.writeText(code).then(() => {
                    const orig = btn.innerText;
                    btn.innerText = 'COPIED!';
                    btn.style.background = '#84cc16';
                    btn.style.color = '#0c0a09';
                    setTimeout(() => {
                        btn.innerText = orig;
                        btn.style.background = '';
                        btn.style.color = '';
                    }, 1500);
                });
            },

            // ────────────────────────────────────────────────────────────────
            init: () => {
                const currentId = SessionManager.getCurrentSessionId();
                if (currentId) SessionManager.loadSession(currentId);
                else SessionManager.createNewSession();
            },

            switchModel: (modelKey) => {
                ChatUI.currentModelKey = modelKey;
                document.querySelectorAll('.model-tab').forEach(el => el.classList.remove('active'));
                const tab = document.getElementById(`tab-${modelKey}`);
                if(tab) tab.classList.add('active');
            },

            setInput: (text) => {
                const input = document.getElementById('user-input');
                input.value = text;
                input.focus();
            },

            resetUI: () => {
                document.getElementById('welcome-section').classList.remove('hidden');
                document.getElementById('chat-history').classList.add('hidden');
                document.getElementById('chat-history').innerHTML = '';
            },

            renderChatHistory: (messages) => {
                const welcome = document.getElementById('welcome-section');
                const historyEl = document.getElementById('chat-history');
                if (!messages || messages.length === 0) { ChatUI.resetUI(); return; }
                welcome.classList.add('hidden');
                historyEl.classList.remove('hidden');
                historyEl.innerHTML = '';
                messages.forEach(msg => ChatUI.appendMessageToDOM(msg.role, msg.text, false, msg.id));
                ChatUI.scrollToBottom();
            },

            appendMessageToDOM: (role, text, isLoading = false, existingId = null) => {
                const history = document.getElementById('chat-history');
                const msgId = existingId || ('msg-' + Date.now() + Math.random().toString(16).slice(2));

                const div = document.createElement('div');
                div.id = msgId;
                div.className = `flex w-full group relative transition-opacity duration-300 ${role === 'user' ? 'justify-end' : 'justify-start'}`;

                const iconLabel = role === 'user' ? 'USR' : 'GROQ';
                const icon = role === 'user'
                    ? `<div class="w-8 h-8 shrink-0 bg-stone-800 flex items-center justify-center text-xs font-mono text-stone-400 select-none">${iconLabel}</div>`
                    : `<div class="w-8 h-8 shrink-0 bg-accent flex items-center justify-center text-xs font-mono text-bg font-bold select-none">${iconLabel}</div>`;

                const bubbleClass = role === 'user'
                    ? "bg-stone-800 text-stone-200 border border-stone-700 overflow-hidden font-mono text-sm"
                    : "bg-transparent border border-accent/50 relative overflow-hidden";

                // User messages: plain escaped text. AI messages: rendered markdown.
                let content;
                if (role === 'user') {
                    const safe = text.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/\n/g, '<br>');
                    content = isLoading ? `<span class="animate-pulse">${safe}</span>` : safe;
                } else {
                    content = isLoading
                        ? `<span class="font-mono text-sm text-accent animate-pulse">${text}</span>`
                        : `<div class="md-body">${ChatUI.renderMarkdown(text)}</div>`;
                }

                div.innerHTML = `
                    <div class="flex items-start gap-4 max-w-[85%] md:max-w-[75%] ${role === 'user' ? 'flex-row-reverse' : 'flex-row'} relative">
                        ${icon}
                        <div class="p-4 ${bubbleClass} shadow-lg leading-relaxed break-words">
                            <div class="message-content min-h-[1.5em]">${content}</div>
                        </div>
                    </div>`;

                history.appendChild(div);
                ChatUI.scrollToBottom();
                return msgId;
            },

            // Called while streaming — shows raw text with a blinking cursor
            updateSystemMessage: (msgId, rawText) => {
                const msgEl = document.getElementById(msgId);
                if (!msgEl) return;
                const contentEl = msgEl.querySelector('.message-content');

                // During streaming render as plain text + cursor for performance
                const safe = rawText
                    .replace(/&/g, "&amp;")
                    .replace(/</g, "&lt;")
                    .replace(/>/g, "&gt;")
                    .replace(/\n/g, '<br>');

                contentEl.innerHTML = `<span class="font-mono text-sm text-stone-300">${safe}</span>`
                    + `<span class="inline-block w-2 h-4 bg-accent ml-1 animate-pulse align-middle"></span>`;

                ChatUI.scrollToBottom();
                ChatUI.tokenCount = rawText.split(/\s+/).length;
                ChatUI.updateLatencyDisplay();
            },

            // Called after stream ends — replace raw text with beautiful rendered markdown
            finalizeSystemMessage: (msgId, rawText) => {
                const msgEl = document.getElementById(msgId);
                if (!msgEl) return;
                const contentEl = msgEl.querySelector('.message-content');
                contentEl.innerHTML = `<div class="md-body">${ChatUI.renderMarkdown(rawText)}</div>`;
            },

            updateLatencyDisplay: () => {
                if (!ChatUI.generationStartTime || ChatUI.tokenCount === 0) return;
                const elapsed = Date.now() - ChatUI.generationStartTime;
                const lat = elapsed / Math.max(1, ChatUI.tokenCount);
                const el = document.getElementById('latency-val');
                if (el) el.innerText = Math.round(lat);
            },

            startLatencyTracking: () => {
                ChatUI.generationStartTime = Date.now();
                ChatUI.tokenCount = 0;
                if (ChatUI.latencyUpdateInterval) clearInterval(ChatUI.latencyUpdateInterval);
                ChatUI.latencyUpdateInterval = setInterval(() => ChatUI.updateLatencyDisplay(), 100);
            },

            stopLatencyTracking: () => {
                if (ChatUI.latencyUpdateInterval) { clearInterval(ChatUI.latencyUpdateInterval); ChatUI.latencyUpdateInterval = null; }
                ChatUI.updateLatencyDisplay();
            },

            scrollToBottom: () => {
                const s = document.getElementById('chat-scroll-area');
                s.scrollTop = s.scrollHeight;
            },

            setGeneratingState: (isGen) => {
                ChatUI.isGenerating = isGen;
                const btn = document.getElementById('send-btn');
                const icon = document.getElementById('send-icon');
                if (isGen) {
                    btn.classList.add('bg-red-900', 'hover:bg-red-700', 'border-red-500', 'border');
                    btn.classList.remove('bg-stone-800', 'hover:bg-accent');
                    icon.setAttribute('data-lucide', 'square');
                    icon.classList.add('fill-current');
                } else {
                    btn.classList.remove('bg-red-900', 'hover:bg-red-700', 'border-red-500', 'border');
                    btn.classList.add('bg-stone-800', 'hover:bg-accent');
                    icon.setAttribute('data-lucide', 'arrow-right');
                    icon.classList.remove('fill-current');
                }
                lucide.createIcons();
            },

            sendMessage: async () => {
                if (ChatUI.isGenerating) { ChatUI.isGenerating = false; return; }

                const settings = SettingsUI.getSettings();
                if (!settings.apiKey) { alert("MISSING API KEY: Please enter your Groq API Key in the settings menu."); SettingsUI.toggle(); return; }

                const inputEl = document.getElementById('user-input');
                const prompt = inputEl.value.trim();
                if (!prompt) return;

                inputEl.value = '';
                document.getElementById('welcome-section').classList.add('hidden');
                document.getElementById('chat-history').classList.remove('hidden');

                const userMsgId = ChatUI.appendMessageToDOM('user', prompt);
                SessionManager.appendMessageToCurrent('user', prompt, userMsgId);

                ChatUI.setGeneratingState(true);
                const loadingId = ChatUI.appendMessageToDOM('system', 'INITIALIZING GROQ UPLINK...', true);

                ChatUI.startLatencyTracking();
                let accumulatedText = "";

                try {
                    const history = SessionManager.getHistory();
                    const messages = [
                        { role: "system", content: settings.systemPrompt },
                        ...history,
                        { role: "user", content: prompt }
                    ];

                    const response = await fetch("https://api.groq.com/openai/v1/chat/completions", {
                        method: "POST",
                        headers: { "Content-Type": "application/json", "Authorization": `Bearer ${settings.apiKey}` },
                        body: JSON.stringify({
                            messages,
                            model: "groq/compound-mini",
                            temperature: settings.temperature,
                            max_completion_tokens: settings.maxTokens,
                            top_p: 1,
                            stream: true,
                            stop: null,
                            compound_custom: { tools: { enabled_tools: ["web_search","code_interpreter","visit_website","browser_automation"] } }
                        })
                    });

                    if (!response.ok) {
                        const err = await response.json().catch(() => ({}));
                        throw new Error(err.error?.message || `HTTP ${response.status}`);
                    }

                    const reader = response.body.getReader();
                    const decoder = new TextDecoder();

                    while (true) {
                        if (!ChatUI.isGenerating) { reader.cancel(); break; }
                        const { done, value } = await reader.read();
                        if (done) break;
                        const chunk = decoder.decode(value);
                        for (const line of chunk.split('\n')) {
                            if (line.startsWith('data: ') && line !== 'data: [DONE]') {
                                try {
                                    const json = JSON.parse(line.substring(6));
                                    accumulatedText += json.choices[0]?.delta?.content || "";
                                    ChatUI.updateSystemMessage(loadingId, accumulatedText);
                                } catch (e) {}
                            }
                        }
                    }
                } catch (error) {
                    accumulatedText += `\n\n**[SYSTEM_ERROR]:** ${error.message}`;
                    ChatUI.updateSystemMessage(loadingId, accumulatedText);
                } finally {
                    ChatUI.stopLatencyTracking();
                    // ✨ Finalize: convert raw markdown to beautiful HTML
                    ChatUI.finalizeSystemMessage(loadingId, accumulatedText);
                    SessionManager.appendMessageToCurrent('system', accumulatedText, loadingId);
                    ChatUI.setGeneratingState(false);
                }
            }
        };

        // ── Boot ───────────────────────────────────────────────────────────────
        document.addEventListener("DOMContentLoaded", () => {
            lucide.createIcons();

            // Text Scramble
            const scrambleChars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*()_+-=[]{}|;:,.<>?';
            document.querySelectorAll('.scramble').forEach(el => {
                const orig = el.getAttribute('data-text') || el.innerText;
                el.setAttribute('data-text', orig);
                let iteration = 0;
                const iv = setInterval(() => {
                    el.innerText = orig.split("").map((letter, i) => {
                        if (i < iteration) return orig[i];
                        return scrambleChars[Math.floor(Math.random() * 26)];
                    }).join("");
                    if (iteration >= orig.length) clearInterval(iv);
                    iteration += 1 / 3;
                }, 30);
            });

            SessionManager.renderSessionList();
            ChatUI.init();
            WrappedUI.init();
        });
    </script>

</body></html>
